<!-- build time:Tue Oct 12 2021 10:18:10 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2"><meta name="google-site-verification" content="4fXg7_br-6EcJkwb-a6Ci2NLdRf7aMleAsM1L9S1nBI"><link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0"><link rel="stylesheet" href="/css/main.css?v=7.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/2.ico?v=7.2.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/1.ico?v=7.2.0"><link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.2.0",sidebar:{position:"left",display:"post",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!0,fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="第四章 网络层4.1网络层提供的两种服务在计算机网络领域，网络层应该向运输层提供怎样的服务（“面向连接”还是“无连接”）曾引起了长期的争论。 争论焦点的实质就是：在计算机通信中，可靠交付应当由谁来负责？是网络还是端系统？4.1.1让网络负责可靠交付这种观点认为，应借助于电信网的成功经验，让网络负责可靠交付，计算机网络应模仿电信网络，使用面向连接的通信方式通信之前先建立虚电路 (Virtual Ci"><meta property="og:type" content="article"><meta property="og:title" content="计算机网络【四】"><meta property="og:url" content="http://lyxf2000.github.io/posts/1dd8e486/index.html"><meta property="og:site_name" content="乐屿心扉"><meta property="og:description" content="第四章 网络层4.1网络层提供的两种服务在计算机网络领域，网络层应该向运输层提供怎样的服务（“面向连接”还是“无连接”）曾引起了长期的争论。 争论焦点的实质就是：在计算机通信中，可靠交付应当由谁来负责？是网络还是端系统？4.1.1让网络负责可靠交付这种观点认为，应借助于电信网的成功经验，让网络负责可靠交付，计算机网络应模仿电信网络，使用面向连接的通信方式通信之前先建立虚电路 (Virtual Ci"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412105718139.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412105842056.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412110007005.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412110552268.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412110816445.png"><meta property="og:image" content="https://img-blog.csdn.net/20131220100509703?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbHBwcmluY2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><meta property="og:image" content="https://img-blog.csdn.net/20131220100542281?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbHBwcmluY2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412111356544.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412111437685.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412111515927.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412111437685.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414200303052.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210613173819398.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414201807373.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210613172413299.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414202525736.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414202709536.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414202746284.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420212141242.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420212511123.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420213212020.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420214322874.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420214419498.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210613171130919.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420214200601.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420214242031.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420213212020.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210407090613941.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414202525736.png"><meta property="og:image" content="https://img-blog.csdn.net/20131220100509703?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbHBwcmluY2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><meta property="og:image" content="https://img-blog.csdn.net/20131220100542281?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbHBwcmluY2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421162425233.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421162536350.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421170400029.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421170605514.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421170618698.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421171314171.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421171142902.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421172326995.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421174333792.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421174349586.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102851459.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102910467.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102924646.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102937687.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102951062.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426103007421.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210428193817906.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210428194550396.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210428195544509.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210428195715178.png"><meta property="og:updated_time" content="2021-10-11T12:59:19.330Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="计算机网络【四】"><meta name="twitter:description" content="第四章 网络层4.1网络层提供的两种服务在计算机网络领域，网络层应该向运输层提供怎样的服务（“面向连接”还是“无连接”）曾引起了长期的争论。 争论焦点的实质就是：在计算机通信中，可靠交付应当由谁来负责？是网络还是端系统？4.1.1让网络负责可靠交付这种观点认为，应借助于电信网的成功经验，让网络负责可靠交付，计算机网络应模仿电信网络，使用面向连接的通信方式通信之前先建立虚电路 (Virtual Ci"><meta name="twitter:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412105718139.png"><link rel="canonical" href="http://lyxf2000.github.io/posts/1dd8e486/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>计算机网络【四】 | 乐屿心扉</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">乐屿心扉</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Keep Thinking</h1></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-playlist"><a href="/playlist/" rel="section"><i class="menu-item-icon fa fa-fw fa-music"></i><br>歌单</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://lyxf2000.github.io/posts/1dd8e486/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="峻源"><meta itemprop="description" content="乐于心，乐与心，乐之屿，心扉间"><meta itemprop="image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="乐屿心扉"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">计算机网络【四】</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-04-05 20:42:00" itemprop="dateCreated datePublished" datetime="2021-04-05T20:42:00+08:00">2021-04-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-10-11 20:59:19" itemprop="dateModified" datetime="2021-10-11T20:59:19+08:00">2021-10-11</time> </span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">字数统计:</span> <span class="post-count">11.2k(字)</span> </span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">阅读时长≈</span> <span class="post-count">39(分)</span></span><br><p></p></div></header><div class="post-body" itemprop="articleBody"><h2 id="第四章-网络层"><a href="#第四章-网络层" class="headerlink" title="第四章 网络层"></a>第四章 网络层</h2><h3 id="4-1网络层提供的两种服务"><a href="#4-1网络层提供的两种服务" class="headerlink" title="4.1网络层提供的两种服务"></a>4.1网络层提供的两种服务</h3><p>在计算机网络领域，网络层应该向运输层提供怎样的服务（“面向连接”还是“无连接”）曾引起了长期的争论。 争论焦点的实质就是：在计算机通信中，可靠交付应当由谁来负责？是网络还是端系统？</p><h4 id="4-1-1让网络负责可靠交付"><a href="#4-1-1让网络负责可靠交付" class="headerlink" title="4.1.1让网络负责可靠交付"></a>4.1.1让网络负责可靠交付</h4><p>这种观点认为，应借助于电信网的成功经验，让网络负责可靠交付，计算机网络应模仿电信网络，使用面向连接的通信方式</p><ul><li>通信之前先建立虚电路 (Virtual Circuit)，以保证双方通信所需的一切网络资源</li><li>如果再使用可靠传输的网络协议，就可使所发送的分组无差错按序到达终点，不丢失、不重复</li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412105718139.png" alt="image-20210412105718139" style="zoom:67%"><p>补充：</p><ul><li><strong>虚电路表示这只是一条逻辑上的连接</strong>，<strong><em>分组都沿着这条逻辑连接按照存储转发方式传送，而并不是真正建立了一条物理连接</em></strong></li><li>请注意，<strong>电路交换的电话通信是先建立了一条真正的连接</strong></li><li>因此<strong>分组交换的虚连接和电路交换的连接只是类似，但并不完全一样</strong></li></ul><h4 id="4-2-2网络提供数据报服务"><a href="#4-2-2网络提供数据报服务" class="headerlink" title="4.2.2网络提供数据报服务"></a>4.2.2网络提供数据报服务</h4><p>互联网的先驱者提出了一种崭新的网络设计思路</p><ul><li><p><strong>网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务</strong></p></li><li><p><strong>网络在发送分组时不需要先建立连接</strong></p></li><li><ul><li>每一个分组（即 IP 数据报）独立发送，与其前后的分组无关（不进行编号）</li></ul></li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412105842056.png" alt="image-20210412105842056" style="zoom:67%"><ul><li><p><strong>网络层不提供服务质量的承诺</strong></p></li><li><ul><li>即所传送的分组可能出错、丢失、重复和失序（不按序到达终点），当然也不保证分组传送的时限</li></ul></li></ul><p>补充：</p><ul><li>由于传输网络不提供端到端的可靠传输服务，这就使网络中的路由器可以做得比较简单，而且价格低廉（与电信网的交换机相比较）</li><li>如果主机（即端系统）中的进程之间的通信需要是可靠的，那么就由网络的主机中的<strong>运输层负责可靠交付</strong>（包括差错处理、流量控制等）</li></ul><p>采用这种设计思路的好处是：网络的造价大大降低，运行方式灵活，能够适应多种应用</p><h3 id="4-2网际协议-IP"><a href="#4-2网际协议-IP" class="headerlink" title="4.2网际协议 IP"></a>4.2网际协议 IP</h3><h4 id="4-2-1几大协议"><a href="#4-2-1几大协议" class="headerlink" title="4.2.1几大协议"></a>4.2.1几大协议</h4><p>网际协议 IP 是 TCP/IP 体系中两个最主要的协议之一</p><p>与 IP 协议配套使用的还有三个协议：</p><ul><li>地址解析协议 ARP (Address Resolution Protocol)</li><li>网际控制报文协议 ICMP (Internet Control Message Protocol)</li><li>网际组管理协议 IGMP (Internet Group Management Protocol)</li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412110007005.png" alt="image-20210412110007005" style="zoom:50%"><h4 id="4-2-2虚拟互连网络"><a href="#4-2-2虚拟互连网络" class="headerlink" title="4.2.2虚拟互连网络"></a>4.2.2虚拟互连网络</h4><p>将网络互连并能够互相通信，会遇到许多问题需要解决，如：</p><ul><li>不同的寻址方案</li><li>不同的最大分组长度</li><li>不同的网络接入机制</li><li>不同的超时控制</li><li>不同的差错恢复方法</li><li>不同的状态报告方法</li><li>不同的路由选择技术</li><li>不同的用户接入控制</li><li>不同的服务（面向连接服务和无连接服务）</li><li>不同的管理与控制方式等</li></ul><p><strong>如何将异构的网络互相连接起来？</strong></p><h5 id="各层连接需要的中转设备"><a href="#各层连接需要的中转设备" class="headerlink" title="各层连接需要的中转设备"></a>各层连接需要的中转设备</h5><p>将网络互相连接起来要使用一些中间设备。 中间设备又称为中间系统或中继 (relay)系统。</p><p>有以下五种不同的中间设备：</p><ul><li>物理层中继系统：转发器 (repeater)</li><li>数据链路层中继系统：网桥 或 桥接器 (bridge)</li><li>网络层中继系统：路由器 (router)</li><li>网桥和路由器的混合物：桥路器 (brouter)</li><li>网络层以上的中继系统：网关 (gateway)<ul><li><strong><u>网关 (gateway)（可以理解为离主机最近的路由器）</u></strong></li></ul></li></ul><p>补充：</p><p><strong>当中继系统是转发器或网桥时，一般并不称之为网络互连，因为这仅仅是把一个网络扩大了，而这仍然是一个网络。（<em>可理解为仍然是一个局域网，不是两个网的互联</em>）</strong></p><p>网关由于比较复杂，目前使用得较少。</p><p><strong><u>网络互连都是指用路由器进行网络互连和路由选择。</u></strong></p><p><strong><u>由于历史的原因，许多有关 TCP/IP 的文献将网络层使用的路由器称为网关。</u></strong></p><h5 id="互连网络与虚拟互连网络"><a href="#互连网络与虚拟互连网络" class="headerlink" title="互连网络与虚拟互连网络"></a>互连网络与虚拟互连网络</h5><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412110552268.png" alt="image-20210412110552268" style="zoom:50%"><p>谓虚拟互连网络也就是逻辑互连网络，它的意思就是互连起来的各种<strong>物理网络的异构性本来是客观存在的</strong>，但是<strong>我们利用 IP 协议就可以使这些性能各异的网络从用户看起来好像是一个统一的网络。</strong></p><p>使用 IP 协议的虚拟互连网络可简称为 IP 网。</p><p><strong>使用虚拟互连网络的好处是：当互联网上的主机进行通信时，就好像在一个网络上通信一样，而看不见互连的各具体的网络异构细节。</strong></p><p><strong><em>如果在这种覆盖全球的 IP 网的上层使用 TCP 协议，那么就是现在的互联网 (Internet)。</em></strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412110816445.png" alt="image-20210412110816445" style="zoom:67%"><p>如果我们只从网络层考虑问题，那么 IP 数据报就可以想象是在网络层中传送。</p><blockquote><p><strong>==直接交付 :==</strong></p><p>直接交付时,分组的终点是一台与交付者链接在同一个网络上的主机.直接交付在生在两种情况下:</p><p>(1)分组的元电荷终点在同一个物理网络上.</p><p>(2)最后一个路由器与目的主机之间的交付. 发送方很容易判断交付是否是直接的.发送方可以提取终点的网络地址(通过掩码),然后与自己所连接的网络地址相比较.如果是同一个Uli网络,交付就是直接的.</p><p><img src="https://img-blog.csdn.net/20131220100509703?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbHBwcmluY2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="img"></p><p><strong>==间接交付==</strong></p><p><strong>如果目的主机与交付者不在同一个网络上,分组就间接的交付.在间接交付时,分组经过了一个有一个路由器,最后到达与终点链接在同一个网络上的路由器.</strong></p><p><img src="https://img-blog.csdn.net/20131220100542281?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbHBwcmluY2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="img"></p><p>间接交付时,发送方通过分组的目的IP地址和路由表来查找该分组应当被交付的下一个路由器的IP地址,然后发送方再通过ARP协议找出下一个路由器的物理地址.直接交付是在终点的IP地址和终点的物理地址之间进行的地址映射,而间接交付是在下一个路由器的IP地址和下一个路由器的物理地址之间的地址映射.交付总是包括一个直接交付以及零个以上的间接交付,而且最后的交付总是直接交付.</p></blockquote><h4 id="4-2-3分类的-IP-地址"><a href="#4-2-3分类的-IP-地址" class="headerlink" title="4.2.3分类的 IP 地址"></a>4.2.3分类的 IP 地址</h4><p>我们把整个互联网看成为一个单一的、抽象的网络。</p><p><strong>IP 地址就是给每个连接在互联网上的<u>主机（或路由器）</u>分配一个在全世界范围是唯一的 32 位的标识符。</strong></p><p>IP 地址现在由互联网名字和数字分配机构<strong>ICANN (Internet Corporation for Assigned Names and Numbers)进行分配</strong>。</p><p>IP 地址的编址方法</p><ul><li><strong>分类的 IP 地址。</strong>这是<strong>最基本的编址方法</strong>，在1981年就通过了相应的标准协议。</li><li><strong>子网的划分。</strong>这是<strong>对最基本的编址方法的改进</strong>，其标准[RFC 950]在1985年通过。</li><li><strong>构成超网。</strong>这是<strong>比较新的无分类编址方法</strong>。1993年提出后很快就得到推广应用。</li></ul><h5 id="分类-IP-地址"><a href="#分类-IP-地址" class="headerlink" title="分类 IP 地址"></a>分类 IP 地址</h5><ul><li>将IP地址划分为若干个固定类</li><li><strong>每一类地址都由两个固定长度的字段组成，其中一个字段是<u>网络号 net-id</u>，它标志主机（或路由器）所连接到的网络，而另一个字段则是<u>主机号 host-id</u>，它标志该主机（或路由器）</strong></li><li>主机号在它前面的网络号所指明的网络范围内必须是唯一的</li><li>由此可见，一个 IP 地址在整个互联网范围内是唯一的</li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412111356544.png" alt="image-20210412111356544" style="zoom:50%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412111437685.png" alt="image-20210412111437685" style="zoom:60%"><h5 id="点分十进制记法"><a href="#点分十进制记法" class="headerlink" title="点分十进制记法"></a>点分十进制记法</h5><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412111515927.png" alt="image-20210412111515927" style="zoom:67%"><blockquote><p><strong>==就是二进制转十进制，很简单==</strong></p></blockquote><h5 id="IP地址的指派范围"><a href="#IP地址的指派范围" class="headerlink" title="IP地址的指派范围"></a>IP地址的指派范围</h5><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210412111437685.png" alt="image-20210412111437685" style="zoom:60%"><blockquote><p><strong>ip地址有5种</strong></p><p><strong>A类：1.0.0.0~126.255.255.255</strong></p><ul><li><strong>==二进制0开头==</strong></li><li><strong>==十进制1~126==</strong></li></ul><p><strong>B类：128.0.0.0~191.255.255.255</strong></p><ul><li>==<strong>二进制10开头</strong>==</li><li>==<strong>十进制128~191</strong>==</li></ul><p><strong>C类：192.0.0.0~223.255.255.255</strong></p><ul><li>==<strong>二进制110开头</strong>==</li><li>==<strong>十进制192~223</strong>==</li></ul><p><strong>D类：224.0.0.0~239.255.255.255</strong></p><ul><li>==<strong>二进制1110开头</strong>==</li><li>==<strong>十进制224~239</strong>==</li></ul><p><strong>E类：240.0.0.0~254.255.255.255</strong></p><ul><li>==<strong>二进制1111开头</strong>==</li><li>==<strong>十进制239~254</strong>==</li></ul><blockquote><p><strong>其中127.0.0.0~127.255.255.255用于环回测试，D类地址用于组播，E类地址用于科研</strong></p><p><strong>私有地址（可理解为一个网络内部使用，多个网络内部都能使用，不冲突的，因为不和外界网络交流，例如学校学院内网）</strong></p><p><strong>A类10.0.0.0/8：10.0.0.0~10.255.255.255</strong></p><p><strong>B类172.16.0.0/12：172.16.0.0~172.31.255.255</strong></p><p><strong>C类192.168.0.0/16：192.168.0.0~192.168.255.255</strong></p></blockquote><p>==<strong>记忆：</strong>==</p><p>==<strong>二进制：0开头，四个1结尾，中间都是0前面挨个增加一个1，然后对应ABCDE</strong>==</p><p><strong>==十进制：128、192、224、239记住四个临界点，很容易判断出5个区间，ABCDE(只不过要注意A的0和127不能用)==</strong></p></blockquote><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414200303052.png" alt="image-20210414200303052" style="zoom:50%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210613173819398.png" alt="image-20210613173819398" style="zoom:67%"><blockquote><p>王道中关于那两个减1：</p><p>192.0和224.0不认为是可分配的。</p><p><a href="https://www.bilibili.com/read/cv3993924/" target="_blank" rel="noopener">有关B类和C类第一个可用网络号的问题</a></p></blockquote><blockquote><p><strong>==为什么A类最大可指派的网络数要减2（本来不应该是0~127吗问什么变成了1-126）？==</strong></p><ul><li><u><strong><em>网络段</em>全0的IP地址是个保留地址，指“本网络”</strong></u></li><li><u><strong><em>网络字号</em>为127（01111111）保留作为本地软件的环回测试</strong></u><ul><li><u><strong>若主机发送一个目的地址为环回地址的IP数据报，则本主机中的协议软件就会处理数据报中的数据，不会发送到任何网络。（大家的测试数据要是都发，那网络得多拥挤啊？且没啥用浪费资源）</strong></u></li><li><strong><em>换种说法：网络号为127的地址根本不是一个网络地址，它不会出现在任何网络上</em></strong></li></ul></li></ul><p><strong>==为什么B、C类最大可指派的网络数不用减2？==</strong></p><p><strong><u>因为该类的网络类别本身前缀就保证了不可能是全0或者全1</u></strong></p><p><strong>==为什么最大主机数要减2？==</strong></p><ul><li><u><strong><em>主机段</em>全0代表本网络，<em>主机段</em>全1代表本网络上的所有主机</strong></u><ul><li><strong>例如：</strong></li><li><strong>IP地址为5.6.7.8所在的网络地址就是5.0.0.0</strong></li><li><strong>128.7.255.255表示在网络128.7.0.0上的所有主机</strong></li><li><strong>0.0.0.35则表示“在这个网络上主机号为35的主机”</strong></li></ul></li></ul><p><strong>==注意网络段的全0全1和主机段的全0全1的区别！！==</strong></p></blockquote><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414201807373.png" alt="image-20210414201807373" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210613172413299.png" alt="image-20210613172413299" style="zoom:67%"><h5 id="IP-地址的一些重要特点"><a href="#IP-地址的一些重要特点" class="headerlink" title="IP 地址的一些重要特点"></a>IP 地址的一些重要特点</h5><p><strong>(1) IP 地址是一种分等级的地址结构。分两个等级的好处是：</strong></p><ul><li>第一，<strong><em>IP 地址管理机构在分配 IP 地址时只分配网络号</em></strong>，而剩下的主机号则由得到该网络号的单位自行分配。这样就方便了 IP 地址的管理</li><li>第二，路由器<strong>仅根据目的主机所连接的网络号来转发分组（而<em>不考虑目的主机号</em>）</strong>，<strong>这样就可以使路由表中的项目数大幅度减少，从而减小了路由表所占的存储空间</strong></li></ul><p><strong>(2) 实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口</strong></p><ul><li><strong>当一个主机同时连接到两个网络上时，该主机就必须同时具有两个相应的 IP 地址，其网络号 net-id 必须是不同的。</strong>这种主机称为<strong><u>多归属主机 (multihomed host)</u></strong></li><li>由于<strong>一个路由器至少应当连接到两个网络</strong>（<strong>这样它才能将 IP 数据报从一个网络转发到另一个网络</strong>），因此<strong><u>一个路由器至少应当有两个不同的 IP 地址。</u></strong></li></ul><p><strong>(3) 用<u>转发器或网桥连接起来的若干个局域网仍为一个网络，因此这些局域网都具有同样的网络号 net-id</u></strong></p><p><strong>(4) <em>所有分配到网络号 net-id 的网络，无论是范围很小的局域网，还是可能覆盖很大地理范围的广域网，都是平等的</em></strong></p><h4 id="4-2-4IP-地址与硬件地址"><a href="#4-2-4IP-地址与硬件地址" class="headerlink" title="4.2.4IP 地址与硬件地址"></a>4.2.4IP 地址与硬件地址</h4><p>IP 地址与硬件地址是不同的地址。</p><p>从层次的角度看，硬件地址（或物理地址）是数据链路层和物理层使用的地址。</p><p>IP 地址是网络层和以上各层使用的地址，是一种逻辑地址（称 IP 地址是逻辑地址是因为 IP 地址是用软件实现的）。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414202525736.png" alt="image-20210414202525736" style="zoom:67%"><p><strong>==注意：MAC地址在IP地址外==</strong></p><p>在 IP 层抽象的互联网上只能看到 IP 数据报。图中的 IP1 → IP2 表示从源地址 IP1 到目的地址 IP2 。两个路由器的 IP 地址并不出现在 IP 数据报的首部中。 *<em>路由器只根据目的站的 IP 地址的网络号进行路由选择。 在具体的物理网络的链路层只能看见 MAC 帧而看不见 IP 数据报 *</em></p><p><strong>IP 层抽象的互联网屏蔽了下层很复杂的细节。</strong>在抽象的网络层上讨论问题，就能够使用统一的、抽象的 IP 地址研究主机和主机或主机和路由器之间的通信 。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414202709536.png" alt="image-20210414202709536" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414202746284.png" alt="image-20210414202746284" style="zoom:67%"><h4 id="4-2-5地址解析协议-ARP"><a href="#4-2-5地址解析协议-ARP" class="headerlink" title="4.2.5地址解析协议 ARP"></a>4.2.5地址解析协议 ARP</h4><h5 id="1-什么是-ARP"><a href="#1-什么是-ARP" class="headerlink" title="(1) 什么是 ARP"></a>(1) 什么是 ARP</h5><p>通信时使用了两个地址：</p><ul><li>IP 地址（网络层地址）</li><li>MAC 地址（数据链路层地址）</li></ul><p>已经知道了一个机器（主机或路由器）的IP地址，如何找出其相应的硬件地址？</p><p>地址解析协议 ARP 就是用来解决这样的问题的。</p><p><strong>ARP 作用：从网络层使用的 IP 地址，解析出在数据链路层使用的硬件地址。</strong></p><h5 id="2-解析的过程"><a href="#2-解析的过程" class="headerlink" title="(2) 解析的过程"></a>(2) 解析的过程</h5><p>不管网络层使用的是什么协议，在实际网络的链路上传送数据帧时，最终还是必须使用硬件地址。 每一个主机都设有一个 ARP 高速缓存 (ARP cache)，里面有所在的<strong>局域网上</strong>的各主机和路由器的 <strong>IP 地址到硬件地址的映射表</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420212141242.png" alt="image-20210420212141242" style="zoom:50%"><p><strong>解析的过程：</strong></p><ul><li><p><strong>当主机 A 欲向本局域网上的某个主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中查看有无主机 B 的 IP 地址。</strong></p></li><li><ul><li><strong>如有，就可查出其对应的硬件地址，再将此硬件地址写入 MAC 帧，然后通过局域网将该 MAC 帧发往此硬件地址。</strong></li><li><strong>如没有， ARP 进程在本局域网上广播发送一个 ARP 请求分组。收到 ARP 响应分组后，将得到的 IP 地址到硬件地址的映射写入 ARP 高速缓存。</strong></li></ul></li></ul><p>补充：</p><ul><li>ARP请求分组：<strong>包含发送方硬件地址 / 发送方 IP 地址 / 目标方硬件地址(未知时填 0) / 目标方 IP 地址</strong></li><li>本地广播 ARP 请求（<strong>路由器不转发ARP请求</strong>）</li><li>ARP 响应分组：<strong>包含发送方硬件地址 / 发送方 IP地址 / 目标方硬件地址 / 目标方 IP 地址</strong></li><li>ARP 分组<strong>封装在物理网络的帧中传输</strong></li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420212511123.png" alt="image-20210420212511123" style="zoom:67%"><h5 id="3-ARP-高速缓存的作用"><a href="#3-ARP-高速缓存的作用" class="headerlink" title="(3) ARP 高速缓存的作用"></a>(3) ARP 高速缓存的作用</h5><p><strong>存放最近获得的 IP 地址到 MAC 地址的绑定，以减少 ARP 广播的数量</strong></p><ul><li>为了减少网络上的通信量，主机 A 在发送其 ARP 请求分组时，就将自己的 IP 地址到硬件地址的映射写入 ARP 请求分组</li><li>当主机 B 收到 A 的 ARP 请求分组时，就<strong>将主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。这对主机 B 以后向 A 发送数据报时就更方便了</strong></li></ul><h5 id="4-应该注意的问题"><a href="#4-应该注意的问题" class="headerlink" title="(4) 应该注意的问题"></a>(4) 应该注意的问题</h5><ul><li>ARP 用于解决同<strong>一个局域网上</strong>的主机或路由器的 IP 地址和硬件地址的映射问题</li><li>如果所要找的主机和源主机<strong>不在同一个局域网上，那么就要通过 ARP 找到一个位于本局域网上的某个路由器的硬件地址，然后把分组发送给这个路由器，让这个路由器把分组转发给下一个网络。<em>剩下的工作就由下一个网络来做</em></strong></li><li>从 IP 地址到硬件地址的解析是自动进行的，主机的用户对这种地址解析过程是不知道的</li><li>只要主机或路由器要和本网络上的另一个已知 IP 地址的主机或路由器进行通信，ARP 协议就会自动地将该 IP 地址解析为链路层所需要的硬件地址</li></ul><h5 id="5-使用-ARP-的四种典型情况"><a href="#5-使用-ARP-的四种典型情况" class="headerlink" title="(5) 使用 ARP 的四种典型情况"></a><strong>(5) 使用 ARP 的四种典型情况</strong></h5><blockquote><ul><li><u><strong>发送方是<em>主机</em>，要把 IP 数据报发送到<em>本网络上</em>的另一个主机。这时用 ARP 找到目的主机的硬件地址</strong></u></li><li><u><strong>发送方是<em>主机</em>，要把 IP 数据报发送到<em>另一个网络</em>上的一个主机。这时用 ARP 找到本网络上的一个路由器的硬件地址。剩下的工作由这个路由器来完成</strong></u></li><li><u><strong>发送方是<em>路由器</em>，要把 IP 数据报转发到<em>本网络</em>上的一个主机。这时用 ARP 找到目的主机的硬件地址</strong></u></li><li><u><strong>发送方是<em>路由器</em>，要把 IP 数据报转发到<em>另一个网络</em>上的一个主机。这时用 ARP 找到本网络上另一个路由器的硬件地址。剩下的工作由这个路由器来完成</strong></u></li></ul><p><strong>==总之：下一个目的是本网络主机，则是主机MAC，下一个目的是另一个网络的主机，则是路由器的MAC==</strong></p></blockquote><h5 id="6-不直接使用硬件地址进行通信"><a href="#6-不直接使用硬件地址进行通信" class="headerlink" title="(6)不直接使用硬件地址进行通信"></a>(6)不直接使用硬件地址进行通信</h5><ul><li>由于全世界存在着各式各样的网络，它们使用不同的硬件地址。要使这些异构网络能够互相通信就必须进行非常复杂的硬件地址转换工作，因此几乎是不可能的事</li><li><strong>IP 编址把这个复杂问题解决了</strong>。连接到互联网的主机只需各自拥有一个唯一的 IP 地址，它们之间的通信就像连接在同一个网络上那样简单方便，因为上述的调用 ARP 的复杂过程都是由计算机软件自动进行的，对用户来说是看不见这种调用过程的</li><li><strong>因此，在虚拟的 IP 网络上用 IP 地址进行通信给广大的计算机用户带来了很大的方便</strong></li></ul><h4 id="4-2-6IP-数据报的格式"><a href="#4-2-6IP-数据报的格式" class="headerlink" title="4.2.6IP 数据报的格式"></a>4.2.6IP 数据报的格式</h4><p><strong>一个 IP 数据报由首部和数据两部分组成</strong></p><p>首部的前一部分是<strong>固定长度</strong>，共 <strong><u>20 字节</u></strong>，是<strong><u>所有 IP 数据报必须具有</u></strong>的</p><p>在首部的固定部分的后面是一些<strong>可选字段</strong>，其<strong>长度是可变的</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420213212020.png" alt="image-20210420213212020" style="zoom:67%"><h5 id="1-固定部分-20-字节"><a href="#1-固定部分-20-字节" class="headerlink" title="(1) 固定部分(20 字节)"></a><strong>(1) 固定部分(20 字节)</strong></h5><ul><li><p><strong>版本——占 4 位</strong>，指 IP 协议的版本。目前的 IP 协议版本号为 4 (即 IPv4)</p></li><li><p><strong>首部长度——占 4 位</strong>，可表示的最大数值是 15 个单位(<strong>==一个单位为 4 字节==</strong>)，<strong>因此 IP 的首部长度的最大值是 60 字节</strong></p><ul><li><strong>==因为具有可变部分，所以为了告诉及其，真正的数据再哪儿，需要告诉首部有多长==</strong></li></ul></li><li><p>区分服务——占 8 位，用来获得更好的服务。 在旧标准中叫做服务类型，但实际上一直未被使用过。 1998 年这个字段改名为区分服务。 只有在使用区分服务（DiffServ）时，这个字段才起作用。 在一般的情况下都不使用这个字段</p></li><li><p><strong>总长度——占 16 位</strong>，<strong>指首部和数据之和的长度，==单位为字节==</strong>，因此数据报的最大长度为 65535 字节。<strong>==总长度必须不超过最大传送单元 MTU。==</strong></p></li><li><p><strong>标识(identification)</strong> ——占 16 位，<strong>它是一个计数器，用来产生 IP 数据报的标识。</strong></p><ul><li><strong>==加入一个报文太长，需要分片，我们需要标识那些是一个报文，值得注意的是，同样标识就代表是同一个报文的切片（至于顺序，由标志+片偏移配合描述）==</strong></li></ul></li><li><p><strong>标志(flag) ——占 3 位</strong>，<strong>==目前只有前两位有意义。标志字段的最低位是 MF (More Fragment)。MF = 1 表示后面“还有分片”。MF = 0 表示最后一个分片。标志字段中间的一位是 DF (Don’t Fragment) 。只有当 DF = 0 时才允许分片。==</strong></p></li><li><p><strong>片偏移—— 占13 位</strong>，<strong>==指出：较长的分组在分片后某片在原分组中的相对位置。片偏移以 <u>8 个字节为偏移单位。</u>==</strong></p><ul><li><strong>==所以，计算片偏移，需要原数据报分片后，第一个字节数/8==</strong></li></ul></li><li><p><strong>生存时间——占8 位</strong>，记为 TTL (Time To Live)，指示数据报在网络中可通过的路由器数的最大值。</p><ul><li>==防止一些数据，不停地再网络中兜圈子，占用资源==</li></ul></li><li><p><strong>协议——占8 位</strong>，指出<strong>此数据报携带的数据使用何种协议</strong>，以便目的主机的 IP 层将数据部分上交给那个处理过程</p><ul><li><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420214322874.png" alt="image-20210420214322874" style="zoom:33%"></li></ul></li><li><p><strong>首部检验和——占16 位</strong>，只检验数据报的首部，不检验数据部分。这里不采用 CRC 检验码而采用简单的计算方法。</p><ul><li><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420214419498.png" alt="image-20210420214419498" style="zoom:50%"><p><u><strong>从中可以看出，就是把首部，每十六个位进行反码算术运算求和再取反（这里的检验和置0），存到部检验和——占16 位发送出去，接受的时候也把首部每16位进行反码算术运算求和（这里的检验和字段就是之前计算过的数据），再取反，若为0则保留，否则丢弃。</strong></u></p><p><strong>不过几乎不会考，太麻烦了。</strong></p></li></ul></li><li><p><strong>源地址和目的地址都各占 4 字节</strong></p></li></ul><blockquote><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210613171130919.png" alt="image-20210613171130919" style="zoom:67%"></blockquote><h5 id="2-可变部分"><a href="#2-可变部分" class="headerlink" title="(2) 可变部分"></a>(2) 可变部分</h5><p>IP 首部的可变部分就是一个选项字段，用来支持排错、测量以及安全等措施，内容很丰富</p><p>选项字段的长度可变，<strong>从 1 个字节到 40 个字节不等</strong>，取决于所选择的项目增加首部的可变部分是为了增加</p><p>IP 数据报的功能，但这同时也使得 IP 数据报的首部长度成为可变的。这就增加了每一个路由器处理数据报的开销</p><p><strong>实际上这些选项很少被使用</strong></p><blockquote><p>【例4-1】 IP 数据报分片</p><p>一数据报的总长度为 3820 字节，其数据部分的长度为 3800 字节（使用固定首部），需要分片为长度不超过 1420 字节的数据报片。</p><p>因固定首部长度为 20 字节，因此每个数据报片的数据部分长度不能超过 1400 字节。</p><p>于是分为 3 个数据报片，其数据部分的长度分别为 1400、1400 和 1000 字节。</p><p><strong>原始数据报首部被复制为各数据报片的首部，==但必须修改有关字段的值。==</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420214200601.png" alt="image-20210420214200601" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420214242031.png" alt="image-20210420214242031" style="zoom:67%"></blockquote><blockquote><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210420213212020.png" alt="image-20210420213212020" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210407090613941.png" alt="image-20210407090613941" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210414202525736.png" alt="image-20210414202525736" style="zoom:67%"><p><strong>==仔细理解MAC帧、IP数据报之间的关系！==</strong></p><p>==<strong>数据部分+20字节固定（+可变部分）=MAC帧的数据部分</strong>==</p><p>==<strong>而根据MAC帧，我们知道最大不能超过1500字节，所以，数据部分+20字节固定（+可变部分）≤1500字节</strong>==</p></blockquote><h4 id="4-2-7IP-层转发分组的流程"><a href="#4-2-7IP-层转发分组的流程" class="headerlink" title="4.2.7IP 层转发分组的流程"></a>4.2.7IP 层转发分组的流程</h4><p>分组转发是指<strong>在互联网络中路由器转发IP分组的物理传输过程与数据报转发机制。根据分组的目的IP地址与源IP地址是否属于同一个子网可分为直接转发和间接转发</strong>。</p><blockquote><p><strong>大多数计算机网络都不能连续地传送任意长的数据，所以实际上网络系统把数据分割成小块，然后逐块地发送，这种小块就称作<u>分组（packet）</u>。也有些书籍把分组定义为网络层的协议数据单元。</strong></p></blockquote><blockquote><p><strong>==直接交付 :==</strong></p><p>直接交付时,分组的终点是一台与交付者链接在同一个网络上的主机.直接交付在生在两种情况下:</p><p><u><strong>(1)分组的元电荷终点在同一个物理网络上.</strong></u></p><p><u><strong>(2)最后一个路由器与目的主机之间的交付.</strong></u></p><p>发送方很容易判断交付是否是直接的.发送方可以<strong>提取终点的网络地址(通过掩码),然后与自己所连接的网络地址相比较.<em>如果是同一个Uli网络,交付就是直接的.</em></strong></p><p><img src="https://img-blog.csdn.net/20131220100509703?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbHBwcmluY2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="img"></p><p><strong>==间接交付==</strong></p><p><strong>如果目的主机与交付者不在同一个网络上,分组就间接的交付.在间接交付时,分组经过了一个又一个路由器,最后到达与终点链接在同一个网络上的路由器.</strong></p><p><img src="https://img-blog.csdn.net/20131220100542281?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbHBwcmluY2U=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="img"></p><p>间接交付时,<strong>发送方通过分组的目的<u>IP地址和路由表</u>来查找该分组应当被交付的<u>下一个路由器的IP地址</u>,然后发送方再<u>通过ARP协议找出下一个路由器的物理地址</u>.</strong></p><p><strong><u>直接交付是在终点的IP地址和终点的物理地址之间进行的地址映射,</u></strong></p><p><strong><u>而间接交付是在下一个路由器的IP地址和下一个路由器的物理地址之间的地址映射.</u></strong></p><p><strong><em>交付总是包括一个直接交付以及零个以上的间接交付</em>,而且<em>最后的交付总是直接交付</em>.</strong></p></blockquote><h5 id="1-路由"><a href="#1-路由" class="headerlink" title="(1)路由"></a>(1)路由</h5><p><strong>在路由表中，对每一条路由，最主要的是（目的网络地址，下一跳地址）</strong></p><blockquote><p><strong>因为这样才能通过目的网络地址选择向哪儿转发。</strong></p></blockquote><p>假设：有四个 A 类网络通过三个路由器连接在一起。每一个网络上都可能有成千上万个主机。可以想象，若按目的主机号来制作路由表，每一个路由表就有 4 万个项目，即 4 万行（每一行对应于一台主机），则所得出的路由表就会过于庞大。但若按主机所在的网络地址来制作路由表，那么每一个路由器中的路由表就只包含 4 个项目（每一行对应于一个网络），这样就可使路由表大大简化。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421162425233.png" alt="image-20210421162425233" style="zoom:67%"><blockquote><p><strong>个人理解：</strong></p><p>==<strong>一个网络可以链接多个路由器</strong>==</p><p>==<strong>一个路由器可以链接多个网络（一个路由器可以有多个IP地址，(其实主机也能)）</strong>==</p><p><strong>==例如：R1的出口20.0.0.7和R2的出口20.0.0.9（接口0）都在网络20.0.0.0中==</strong></p><p><u><strong>接口0出去，是直接交付，APR协议找出目的主机的物理地址，发出去。</strong></u></p><p><u><strong>而发送给路由器，除了查路由表找到路由的IP地址，还需要APR协议找出该路由器的物理地址，再发给路由器。</strong></u></p><p><strong>==注：一个路由器可以有多个IP地址，路由器的一个接口就能有一个IP地址。==</strong></p></blockquote><p><strong>查找路由表</strong></p><p>根据目的网络地址就能确定下一跳路由器，这样做的结果是：</p><ul><li><p>IP 数据报最终一定可以找到目的主机所在目的网络上的路由器（可能要通过多次的间接交付）。</p></li><li><p>只有到达最后一个路由器时，才试图向目的主机进行直接交付。</p></li></ul><p><strong>特定主机路由</strong></p><ul><li>虽然互联网所有的分组转发都是基于目的主机所在的网络，但在大多数情况下都允许有这样的特例，即为特定的目的主机指明一个路由。</li><li>采用特定主机路由可使网络管理人员能更方便地控制网络和测试网络，同时也可在需要考虑某种安全问题时采用这种特定主机路由。</li></ul><p><strong>默认路由 (default route)</strong></p><ul><li>路由器还可采用默认路由以减少路由表所占用的空间和搜索路由表所用的时间。</li><li>这种转发方式在<strong>一个网络只有很少的对外连接</strong>时是很有用的。</li><li>默认路由在主机发送 IP 数据报时往往更能显示出它的好处。</li><li>如果一个主机连接在一个<strong><u>小网络</u></strong>上，而这个网络<strong><em>只用一个路由器和互联网连接</em></strong>，那么在这种情况下使用默认路由是非常合适的。</li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421162536350.png" alt="image-20210421162536350" style="zoom:67%"><h5 id="2-关于路由表"><a href="#2-关于路由表" class="headerlink" title="(2)关于路由表"></a>(2)关于路由表</h5><p><strong>路由表没有给分组指明到某个网络的完整路径。</strong></p><p><strong>路由表指出，到某个网络应当先到某个路由器（即下一跳路由器）。</strong></p><p><strong>在到达下一跳路由器后，再继续查找其路由表，知道再下一步应当到哪一个路由器。</strong></p><p><strong>这样一步一步地查找下去，直到最后到达目的网络。</strong></p><h5 id="3-一些强调"><a href="#3-一些强调" class="headerlink" title="(3)一些强调"></a>(3)一些强调</h5><p><strong><u>IP 数据报的<em>首部中没有</em>地方可以用来指明“<em>下一跳路由器的 IP 地址</em>”。</u></strong></p><p><strong>当路由器收到待转发的数据报，不是将下一跳路由器的 IP 地址填入 IP 数据报，而是送交下层的网络接口软件。</strong></p><p><strong>网络接口软件使用 ARP 负责将下一跳路由器的 IP 地址转换成硬件地址，并将此硬件地址放在链路层的 MAC 帧的首部，然后根据这个硬件地址找到下一跳路由器。</strong></p><blockquote><p><strong>==值得注意的是，上述介绍说明了，IP数据报本身是保持不变的，转发是通过MAC来做到的，也就是数据链路层（个人认为）==</strong></p></blockquote><h5 id="4-路由器分组转发算法"><a href="#4-路由器分组转发算法" class="headerlink" title="(4)路由器分组转发算法"></a>(4)路由器分组转发算法</h5><ol><li><p><strong>从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。</strong></p></li><li><p><strong>若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行 (3)。</strong></p></li><li><p><strong>若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行 (4)。</strong></p><ul><li><blockquote><p>特定主机路由:这种路由是为特定的目的主机指明一个路由。之前介绍过。</p></blockquote></li></ul></li><li><p><strong>若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行 (5)。</strong></p></li><li><p><strong>若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行 (6)。</strong></p></li><li><p><strong>报告转发分组出错。</strong></p></li></ol><blockquote><p>==<strong>可看出，优先级：本网络就是目的&gt;特定主机路由&gt;到达目的主机所在网络的路由&gt;默认路由</strong>==</p></blockquote><h3 id="4-3划分子网和构造超网"><a href="#4-3划分子网和构造超网" class="headerlink" title="4.3划分子网和构造超网"></a>4.3划分子网和构造超网</h3><h4 id="4-3-1从两级-IP-地址到三级-IP-地址"><a href="#4-3-1从两级-IP-地址到三级-IP-地址" class="headerlink" title="4.3.1从两级 IP 地址到三级 IP 地址"></a>4.3.1从两级 IP 地址到三级 IP 地址</h4><p>在 ARPANET 的早期，IP 地址的设计确实不够合理：</p><p>(1) IP 地址空间的利用率有时很低。</p><p>(2) 给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。</p><p>(3) 两级的 IP 地址不够灵活。</p><blockquote><p><strong>想申请个网络，但是考虑以后发展C类太少，A类B类太多，怎么办？</strong></p><p><strong>你有急事，想现在就用上一个网络，怎么办？</strong></p></blockquote><p><strong>从 1985 年起在 <u>IP 地址中又增加了一个“子网号字段”，使两级的 IP 地址变成为三级的 IP 地址。</u> 这种做法叫做<u>划分子网 (subnetting)</u> 。 划分子网已成为互联网的正式标准协议。</strong></p><h5 id="1-划分子网的基本思路"><a href="#1-划分子网的基本思路" class="headerlink" title="(1)划分子网的基本思路"></a>(1)划分子网的基本思路</h5><p>划分子网纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的网络。</p><p>从主机号借用若干个位作为<strong>子网号 subnet-id</strong>，而主机号 host-id 也就相应减少了若干个位。</p><p><code>IP地址 ::= {&lt;网络号&gt;, &lt;子网号&gt;, &lt;主机号&gt;}</code></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421170400029.png" alt="image-20210421170400029" style="zoom:67%"><p>凡是从其他网络发送给本单位某个主机的 IP 数据报，仍然是根据 IP 数据报的目的网络号 net-id，先找到连接在本单位网络上的路由器。</p><p>然后此路由器在收到 IP 数据报后，再<strong>按目的网络号 net-id 和子网号 subnet-id 找到目的子网。</strong></p><p>最后就将 IP 数据报直接交付目的主机。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421170605514.png" alt="image-20210421170605514" style="zoom:50%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421170618698.png" alt="image-20210421170618698" style="zoom:50%"><p><strong>充分体现：划分子网纯属一个单位内部的事情，对外部网络透明，对外仍然表现为没有划分子网的一个网络。</strong></p><h5 id="2-子网掩码"><a href="#2-子网掩码" class="headerlink" title="(2)子网掩码"></a>(2)子网掩码</h5><p>从一个 IP 数据报的首部并无法判断源主机或目的主机所连接的网络是否进行了子网划分。</p><p>使用子网掩码 (subnet mask) 可以找出 IP 地址中的子网部分。</p><blockquote><p><strong>子网掩码是一个网络或一个子网的重要属性。</strong></p><p><strong>路由器在和相邻路由器交换路由信息时，必须把自己所在网络（或子网）的子网掩码告诉相邻路由器。</strong></p><p><strong>路由器的路由表中的每一个项目，除了要给出目的网络地址外，还必须同时给出该网络的子网掩码。</strong></p><p><strong>若一个路由器连接在两个子网上，就拥有两个网络地址和两个子网掩码。</strong></p></blockquote><p><strong>规则：</strong></p><ul><li><strong>子网掩码长度 ＝ 32 位</strong></li><li><strong>子网掩码左边部分的一连串 1，对应于网络号和子网号</strong></li><li><strong>子网掩码右边部分的一连串 0，对应于主机号</strong></li></ul><p><strong>==(IP 地址) AND (子网掩码) =网络地址==</strong></p><blockquote><p><strong>==注意AND运算特性：==</strong></p><p><strong>==遇到1不变，遇到0变0。==</strong></p><p><strong>再看子网掩码：从某位，左侧全是1右侧全是0。</strong></p><p><strong>通过可网络地址的and运算，主机号段变成0代表本网络，其它位不变，直接说明是那个子网！</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421171314171.png" alt="image-20210421171314171" style="zoom:67%"></blockquote><p>对于A、B、C类网络的默认子网掩码：</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421171142902.png" alt="image-20210421171142902" style="zoom:67%"><h5 id="3-子网掩码的划分方法"><a href="#3-子网掩码的划分方法" class="headerlink" title="(3)子网掩码的划分方法"></a>(3)子网掩码的划分方法</h5><p><strong>有<em>固定长度子网</em>和<em>变长子网</em>两种子网划分方法。</strong></p><p><strong><u>在采用固定长度子网时，所划分的所有子网的子网掩码都是相同的。</u></strong></p><p>虽然根据已成为互联网标准协议的 RFC 950 文档，子网号不能为全 1 或全 0，但随着无分类域间路由选择 CIDR 的广泛使用，现在全 1 和全 0 的子网号也可以使用了，但一定要谨慎使用，确认你的路由器所用的路由选择软件是否支持全 0 或全 1 的子网号这种较新的用法。</p><p><strong>划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数。</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421172326995.png" alt="image-20210421172326995" style="zoom:67%"><blockquote><p><strong>为什么表中的“子网号的位数”中没有 0, 1, 15 和 16 这四种情况，因为这没有意义？</strong></p><p>当子网号位数为0时： 相当于没有划分子网。</p><p>当子网号位数为16时：相当于主机所占位数全部用于划分子网，只有子网号，却没有主机号了。（即每个子网中的有效主机数为0）</p><p>当子网号位数为15时：相当于主机号剩余一位，即有两种取值（0,1）。当取值为0时，实际为该子网的网络地址，取值为1时实际为该子网的广播地址。这两个取值都不能作为有效的主机号标识，所以也没有意义。</p><p>当子网号位数为1时：相当于子网号位一位，即有两种取值（0,1）。这两个取值也就是含子网号全0全1与父网络网络地址和广播地址重名冲突的两种情况（对路由器来说具有二义性，会发生错误）。</p></blockquote><blockquote><p><strong><u>选定的子网掩码将创建多少个子网?</u></strong></p><p><strong><em>2^x^个，其中x是子网掩码借用的主机位数。</em></strong></p><p><strong><u>每个子网可包含多少台主机?</u></strong></p><p><strong><em>2^y^-2台，其中y是没被借用的主机位的位数。（<u>就是子网掩码二进制下0位数</u>）</em>-2是因为，主机位全为0的部分是这个子网的网段号（Net_id），全为1的部分是这个网段的广播地址。</strong></p><p><strong>==但是要注意：随着无分类域间路由选择CIDR的广泛使用，是可以让子网号全为1或者全为0的，这样就不用减2了。但一定要谨慎使用，要弄清你的路由器所用的路由选择软件是否支持全0或全1的子网号这种较新的用法。==</strong></p></blockquote><blockquote><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421174333792.png" alt="image-20210421174333792" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210421174349586.png" alt="image-20210421174349586" style="zoom:67%"></blockquote><blockquote><p><strong>==不规则子网划分的方法总结（个人经验）：==</strong></p><ul><li>==<strong>从大到小划分。</strong>==</li><li>==<strong>先找主机数，确定主机号、网络号的数量。</strong>==</li><li>==<strong>根据网络号的数量选择没有用过的网络号码。（注意选择前缀）</strong>==<ul><li>==<strong>网络号从从最小那个位置开始改变确认网络号</strong>==</li></ul></li></ul><p><strong>树状图？我没试过。</strong></p></blockquote><h4 id="4-3-2使用子网时分组的转发"><a href="#4-3-2使用子网时分组的转发" class="headerlink" title="4.3.2使用子网时分组的转发"></a>4.3.2使用子网时分组的转发</h4><p>在不划分子网的两级 IP 地址下，从 IP 地址得出网络地址是个很简单的事</p><p>但在划分子网的情况下，从 IP 地址却不能唯一地得出网络地址来，这是因为网络地址取决于那个网络所采用的子网掩码，但数据报的首部并没有提供子网掩码的信息</p><p>因此分组转发的算法也必须做相应的改动</p><p><strong>(1) 从收到的分组的首部提取目的 IP 地址 D</strong></p><p><strong>(2) 先用各网络的子网掩码和 D 逐位相“与”，看是否和相应的网络地址匹配。若匹配，则将分组直接交付。否则就是间接交付，执行 (3)</strong></p><p><strong>(3) 若路由表中有目的地址为 D 的特定主机路由，则将分组传送给指明的下一跳路由器；否则，执行</strong></p><p><strong>(4) 对路由表中的每一行，将子网掩码和 D 逐位相“与”。若结果与该行的目的网络地址匹配，则将分组传送给该行指明的下一跳路由器；否则，执行 (5)</strong></p><p><strong>(5) 若路由表中有一个默认路由，则将分组传送给路由表中所指明的默认路由器；否则，执行 (6)</strong></p><p><strong>(6) 报告转发分组出错</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102851459.png" alt="image-20210426102851459" style="zoom:50%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102910467.png" alt="image-20210426102910467" style="zoom:50%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102924646.png" alt="image-20210426102924646" style="zoom:50%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102937687.png" alt="image-20210426102937687" style="zoom:50%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426102951062.png" alt="image-20210426102951062" style="zoom:50%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210426103007421.png" alt="image-20210426103007421" style="zoom:50%"><blockquote><p>==<strong>注：</strong>==</p><ul><li>==<strong>首先目的地址和路由器直接相连的网络的子网掩码计算，看看目的地址是不是在直连网络，若是则直接交付。否则交给路由器。</strong>==</li><li>==<strong>按照特定<em>主机路由、普通路由、默认路由</em>的优先级，依次检查。</strong>==<ul><li><strong>==检查就是用目的地址和相应子网掩码计算，和前面的目的网络地址比较，一致则交付给该路由器。==</strong></li></ul></li></ul></blockquote><h4 id="4-3-3-无分类编址-CIDR"><a href="#4-3-3-无分类编址-CIDR" class="headerlink" title="4.3.3  无分类编址 CIDR"></a>4.3.3 无分类编址 CIDR</h4><h5 id="CIDR"><a href="#CIDR" class="headerlink" title="CIDR"></a>CIDR</h5><p>划分子网在一定程度上缓解了互联网在发展中遇到的困难。然而在 1992 年互联网仍然面临三个必须尽早解决的问题：</p><p>B 类地址在 1992 年已分配了近一半，眼看就要在 1994 年 3 月全部分配完毕！</p><p>互联网主干网上的路由表中的项目数急剧增长（从几千个增长到几万个）。</p><p>整个 IPv4 的地址空间最终将全部耗尽。</p><p>CIDR干了什么：</p><ul><li>CIDR<strong>消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念，因而可以更加有效地分配 IPv4 的地址空间。</strong></li><li><strong>CIDR使用各种长度的“网络前缀”(network-prefix)来代替分类地址中的网络号和子网号。</strong></li><li><strong>IP 地址从三级编址（使用子网掩码）又回到了两级编址。</strong></li></ul><p><code>IP地址 ::= {&lt;网络前缀&gt;, &lt;主机号&gt;}</code></p><p>CIDR 使用“斜线记法”(slash notation)，它又称为 CIDR 记法，<strong>即在 IP 地址面加上一个斜线“/”，然后写上网络前缀所占的位数（这个数值对应于三级编址中子网掩码中 1 的个数）</strong>。例如： 220.78.168.0/24</p><p><strong>CIDR 把网络前缀都相同的连续的 IP 地址组成“CIDR 地址块”。</strong> 128.14.32.0/20 表示的地址块共有 2^12^个地址（因为斜线后面的 20 是网络前缀的位数，所以这个地址的主机号是 12 位）</p><ul><li>这个地址块的起始地址是 128.14.32.0</li><li>在不需要指出地址块的起始地址时，也可将这样的地址块简称为“/20 地址块”</li><li>128.14.32.0/20 地址块的最小地址：128.14.32.0</li><li>128.14.32.0/20 地址块的最大地址：128.14.47.255</li><li>全 0 和全 1 的主机号地址一般不使用</li></ul><h5 id="路由聚合"><a href="#路由聚合" class="headerlink" title="路由聚合"></a><strong>路由聚合</strong></h5><ul><li>一个 CIDR 地址块可以表示很多地址，这种地址的聚合常称为<strong>路由聚合</strong>，它使得路由表中的一个项目可以表示很多个（例如上千个）原来传统分类地址的路由</li><li>路由聚合有利于减少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能</li><li><strong>路由聚合也称为构成超网 (supernetting)</strong></li><li>CIDR 虽然不使用子网了，但仍然使用<strong>“掩码”</strong>这一名词（但不叫子网掩码）</li><li>对于 /20 地址块，它的掩码是 20 个连续的 1。 斜线记法中的数字就是掩码中1的个数。</li></ul><h5 id="CIDR-记法的其他形式"><a href="#CIDR-记法的其他形式" class="headerlink" title="CIDR 记法的其他形式"></a>CIDR 记法的其他形式</h5><ul><li><p>10.0.0.0/10 可简写为 10/10，也就是<strong><u>把点分十进制中低位连续的 0 省略。</u></strong></p></li><li><p>10.0.0.0/10 隐含地指出 IP 地址 10.0.0.0 的掩码是 255.192.0.0。此掩码可表示为：</p></li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210428193817906.png" alt="image-20210428193817906" style="zoom:50%"><ul><li>网络前缀的后面加一个星号 * 的表示方法，如 00001010 00<em>，*</em><u>在星号 * 之前是网络前缀，而星号 * 表示 IP 地址中的主机号，可以是任意值。</u>**</li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210428194550396.png" alt="image-20210428194550396" style="zoom:67%"><p>==<strong>如果发现平均划分子网不能满足要求，或者认为过于浪费，那么可以根据需要划分子网。很多时候上图中这种比较直接的划分可以看出一些规律基本上都是一个子网后推一位，最后的两个前缀位数一样（23、24、25、26、26）</strong>==</p><p>这个 ISP 共有 64 个 C 类网络。如果不采用 CIDR 技术，则在与该 ISP 的路由器交换路由信息的每一个路由器的路由表中，就需要有 64 个项目。但采用地址聚合后，只需用路由聚合后的 1 个项目 206.0.64.0/18 就能找到该 ISP。</p><h5 id="最长前缀匹配"><a href="#最长前缀匹配" class="headerlink" title="最长前缀匹配"></a>最长前缀匹配</h5><ul><li>使用 CIDR 时，路由表中的每个项目由“网络前缀”和“下一跳地址”组成。<strong>在查找路由表时可能会得到不止一个匹配结果</strong></li><li>应当从匹配结果中选择具有最长网络前缀的路由：最长前缀匹配 (longest-prefix matching)</li><li>网络前缀越长，其地址块就越小，因而路由就越具体 (more specific)</li><li>最长前缀匹配又称为<strong>最长匹配</strong>或<strong>最佳匹配</strong></li></ul><p>收到的分组的目的地址 D = 206.0.71.130</p><p>路由表中的项目：206.0.68.0/22 1</p><p>​ 206.0.71.128/25 2</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210428195544509.png" alt="image-20210428195544509" style="zoom:67%"><p><strong>==选择两个匹配的地址中更具体的一个，即选择最长前缀的地址。==</strong></p><h5 id="使用二叉线索查找路由表"><a href="#使用二叉线索查找路由表" class="headerlink" title="使用二叉线索查找路由表"></a>使用二叉线索查找路由表</h5><ul><li>当路由表的项目数很大时，怎样设法减小路由表的查找时间就成为一个非常重要的问题</li><li>为了进行更加有效的查找，通常是将无分类编址的路由表存放在一种层次的数据结构中，然后自上而下地按层次进行查找。这里最常用的就是二叉线索 (binary trie)</li><li>IP 地址中从左到右的比特值决定了从根结点逐层向下层延伸的路径，而二叉线索中的各个路径就代表路由表中存放的各个地址</li><li>为了提高二叉线索的查找速度，广泛使用了各种压缩技术</li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210428195715178.png" alt="image-20210428195715178" style="zoom:50%"><blockquote><ul><li>==将路由表中每个IP地址的<strong>唯一前缀</strong>，构造二叉线索==</li><li>==进行查找时，只要能够和唯一前缀匹配上，就认为查找成功==</li></ul></blockquote></div><div><div><div style="text-align:center;color:#555;font-size:14px">-----------------------本文结束 <i class="fa fa-heart"></i> 感谢阅读-----------------------</div></div></div><div><div id="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！恰饭^.^~</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/20190826214611.png" alt="峻源 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/20190826214431.png" alt="峻源 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>峻源</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="http://lyxf2000.github.io/posts/1dd8e486/" title="计算机网络【四】">http://lyxf2000.github.io/posts/1dd8e486/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/aaf5fde3/" rel="next" title="计算机网络【三】"><i class="fa fa-chevron-left"></i> 计算机网络【三】</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/724621c1/" rel="prev" title="计算机网络【五】">计算机网络【五】 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80NjM0NC8yMjg1NQ=="></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/avatar.gif" alt="峻源"></a><p class="site-author-name" itemprop="name">峻源</p><div class="site-description motion-element" itemprop="description">乐于心，乐与心，乐之屿，心扉间</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">122</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">21</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:1194320636@qq.com" title="QE-Mail &rarr; mailto:1194320636@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>QE-Mail</a> </span><span class="links-of-author-item"><a href="https://music.163.com/#/playlist?id=699716432" title="CloudMusic &rarr; https://music.163.com/#/playlist?id=699716432" rel="noopener" target="_blank"><i class="fa fa-fw fa-music"></i>CloudMusic</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://www.baidu.com/" title="https://www.baidu.com/" rel="noopener" target="_blank">百度</a></li><li class="links-of-blogroll-item"><a href="https://www.google.com/?hl=zh_CN" title="https://www.google.com/?hl=zh_CN" rel="noopener" target="_blank">谷歌</a></li><li class="links-of-blogroll-item"><a href="https://www.zhihu.com/" title="https://www.zhihu.com/" rel="noopener" target="_blank">知乎</a></li><li class="links-of-blogroll-item"><a href="https://juejin.im/" title="https://juejin.im/" rel="noopener" target="_blank">掘金</a></li><li class="links-of-blogroll-item"><a href="https://github.com/" title="https://github.com/" rel="noopener" target="_blank">github</a></li><li class="links-of-blogroll-item"><a href="https://www.luogu.org/" title="https://www.luogu.org/" rel="noopener" target="_blank">洛谷</a></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#第四章-网络层"><span class="nav-number">1.</span> <span class="nav-text">第四章 网络层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1网络层提供的两种服务"><span class="nav-number">1.1.</span> <span class="nav-text">4.1网络层提供的两种服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1让网络负责可靠交付"><span class="nav-number">1.1.1.</span> <span class="nav-text">4.1.1让网络负责可靠交付</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2网络提供数据报服务"><span class="nav-number">1.1.2.</span> <span class="nav-text">4.2.2网络提供数据报服务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2网际协议-IP"><span class="nav-number">1.2.</span> <span class="nav-text">4.2网际协议 IP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1几大协议"><span class="nav-number">1.2.1.</span> <span class="nav-text">4.2.1几大协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2虚拟互连网络"><span class="nav-number">1.2.2.</span> <span class="nav-text">4.2.2虚拟互连网络</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#各层连接需要的中转设备"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">各层连接需要的中转设备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#互连网络与虚拟互连网络"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">互连网络与虚拟互连网络</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3分类的-IP-地址"><span class="nav-number">1.2.3.</span> <span class="nav-text">4.2.3分类的 IP 地址</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#分类-IP-地址"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">分类 IP 地址</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#点分十进制记法"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">点分十进制记法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IP地址的指派范围"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">IP地址的指派范围</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IP-地址的一些重要特点"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">IP 地址的一些重要特点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4IP-地址与硬件地址"><span class="nav-number">1.2.4.</span> <span class="nav-text">4.2.4IP 地址与硬件地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5地址解析协议-ARP"><span class="nav-number">1.2.5.</span> <span class="nav-text">4.2.5地址解析协议 ARP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-什么是-ARP"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">(1) 什么是 ARP</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-解析的过程"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">(2) 解析的过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-ARP-高速缓存的作用"><span class="nav-number">1.2.5.3.</span> <span class="nav-text">(3) ARP 高速缓存的作用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-应该注意的问题"><span class="nav-number">1.2.5.4.</span> <span class="nav-text">(4) 应该注意的问题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-使用-ARP-的四种典型情况"><span class="nav-number">1.2.5.5.</span> <span class="nav-text">(5) 使用 ARP 的四种典型情况</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-不直接使用硬件地址进行通信"><span class="nav-number">1.2.5.6.</span> <span class="nav-text">(6)不直接使用硬件地址进行通信</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-6IP-数据报的格式"><span class="nav-number">1.2.6.</span> <span class="nav-text">4.2.6IP 数据报的格式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-固定部分-20-字节"><span class="nav-number">1.2.6.1.</span> <span class="nav-text">(1) 固定部分(20 字节)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-可变部分"><span class="nav-number">1.2.6.2.</span> <span class="nav-text">(2) 可变部分</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-7IP-层转发分组的流程"><span class="nav-number">1.2.7.</span> <span class="nav-text">4.2.7IP 层转发分组的流程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-路由"><span class="nav-number">1.2.7.1.</span> <span class="nav-text">(1)路由</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-关于路由表"><span class="nav-number">1.2.7.2.</span> <span class="nav-text">(2)关于路由表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-一些强调"><span class="nav-number">1.2.7.3.</span> <span class="nav-text">(3)一些强调</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-路由器分组转发算法"><span class="nav-number">1.2.7.4.</span> <span class="nav-text">(4)路由器分组转发算法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3划分子网和构造超网"><span class="nav-number">1.3.</span> <span class="nav-text">4.3划分子网和构造超网</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1从两级-IP-地址到三级-IP-地址"><span class="nav-number">1.3.1.</span> <span class="nav-text">4.3.1从两级 IP 地址到三级 IP 地址</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-划分子网的基本思路"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">(1)划分子网的基本思路</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-子网掩码"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">(2)子网掩码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-子网掩码的划分方法"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">(3)子网掩码的划分方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2使用子网时分组的转发"><span class="nav-number">1.3.2.</span> <span class="nav-text">4.3.2使用子网时分组的转发</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-无分类编址-CIDR"><span class="nav-number">1.3.3.</span> <span class="nav-text">4.3.3 无分类编址 CIDR</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#CIDR"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">CIDR</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#路由聚合"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">路由聚合</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CIDR-记法的其他形式"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">CIDR 记法的其他形式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#最长前缀匹配"><span class="nav-number">1.3.3.4.</span> <span class="nav-text">最长前缀匹配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用二叉线索查找路由表"><span class="nav-number">1.3.3.5.</span> <span class="nav-text">使用二叉线索查找路由表</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love" id="heart"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">峻源</span></div><span>本站已运行<span id="showDays"></span></span><script>var seconds=1e3,minutes=60*seconds,hours=60*minutes,days=24*hours,years=365*days,birthDay=Date.UTC(2019,8,1,14,0,0);setInterval(function(){var e=new Date,s=e.getFullYear(),t=e.getMonth()+1,a=e.getDate(),o=e.getHours(),r=e.getMinutes(),n=e.getSeconds(),h=Date.UTC(s,t,a,o,r,n),u=h-birthDay,d=Math.floor(u/years),y=Math.floor(u/days-365*d),i=Math.floor((u-(365*d+y)*days)/hours),l=Math.floor((u-(365*d+y)*days-i*hours)/minutes),M=Math.floor((u-(365*d+y)*days-i*hours-l*minutes)/seconds);document.getElementById("showDays").innerHTML=""+d+"年"+y+"天"+i+"小时"+l+"分钟"+M+"秒"},1e3)</script><div><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">访问人数：<span id="busuanzi_value_site_uv"></span> </span>&nbsp;|&nbsp; <i class="fa fa-eye"></i> <span id="busuanzi_container_site_pv">总访问量：<span id="busuanzi_value_site_pv"></span> </span>&nbsp;|&nbsp; <i class="fa fa-pencil"></i> <span class="post-count">博客全站共 453.9k 字</span></div></div></footer></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=3.4.1"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script><script src="/js/utils.js?v=7.2.0"></script><script src="/js/motion.js?v=7.2.0"></script><script src="/js/affix.js?v=7.2.0"></script><script src="/js/schemes/pisces.js?v=7.2.0"></script><script src="/js/scrollspy.js?v=7.2.0"></script><script src="/js/post-details.js?v=7.2.0"></script><script src="/js/next-boot.js?v=7.2.0"></script><script>window.livereOptions={refer:"posts/1dd8e486/"},function(e,t){var n,r=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&(n=e.createElement(t),n.src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,r.parentNode.insertBefore(n,r))}(document,"script")</script><script>function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var e=$("#local-search-input");e.attr("autocapitalize","none"),e.attr("autocorrect","off"),e.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():e,r=document.getElementById(t),s=document.getElementById(o),a=function(){var e=r.value.trim().toLowerCase(),t=e.split(/[\s\-]+/);t.length>1&&t.push(e);var o=[];if(e.length>0&&n.forEach(function(n){function r(t,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===e&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(e,t){var o="",n=t.start;return t.hits.forEach(function(t){o+=e.substring(n,t.position);var r=t.position+t.length;o+='<b class="search-keyword">'+e.substring(t.position,r)+"</b>",n=r}),o+=e.substring(n,t.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url).replace(/\/{2,}/g,"/"),d=[],g=[];if(""!=l&&(t.forEach(function(e){function t(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}d=d.concat(t(e,h,!1)),g=g.concat(t(e,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(e){b+="<a href='"+f+'\'><p class="search-result">'+s(p,e)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===t.length&&""===t[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>';else{o.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id});var a='<ul class="search-result-list">';o.forEach(function(e){a+=e.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()}),$(document).on("keyup",function(e){var t=27===e.which&&$(".search-popup").is(":visible");t&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><link rel="stylesheet" href="/dist/APlayer.min.css"><div id="aplayer"></div><script type="text/javascript" src="/dist/APlayer.min.js"></script><script type="text/javascript" src="/dist/music.js"></script><script type="text/javascript" src="/js/firework.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":220,"height":400},"mobile":{"show":false},"react":{"opacity":0.9},"log":false});</script></body></html><!-- rebuild by neat -->