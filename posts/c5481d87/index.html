<!-- build time:Tue Oct 12 2021 11:47:50 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2"><meta name="google-site-verification" content="4fXg7_br-6EcJkwb-a6Ci2NLdRf7aMleAsM1L9S1nBI"><link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0"><link rel="stylesheet" href="/css/main.css?v=7.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/2.ico?v=7.2.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/1.ico?v=7.2.0"><link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.2.0",sidebar:{position:"left",display:"post",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!0,fancybox:!0,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="5.6 TCP 可靠传输的实现5.6.1 以字节为单位的滑动窗口TCP 使用流水线传输和滑动窗口协议实现高效、可靠的传输。TCP 的滑动窗口是以字节为单位的。发送方 A 和接收方 B 分别维持一个发送窗口和一个接收窗口。发送窗口表示：在没有收到确认的情况下，可以连续把窗口内的数据全部发送出去。接收窗口表示：只允许接收落入窗口内的数据。窗口的运行    发送缓存和接收缓存发送方的应用进程把字节流写入"><meta name="keywords" content="计算机网络"><meta property="og:type" content="article"><meta property="og:title" content="计算机网络【七】"><meta property="og:url" content="http://lyxf2000.github.io/posts/c5481d87/index.html"><meta property="og:site_name" content="乐屿心扉"><meta property="og:description" content="5.6 TCP 可靠传输的实现5.6.1 以字节为单位的滑动窗口TCP 使用流水线传输和滑动窗口协议实现高效、可靠的传输。TCP 的滑动窗口是以字节为单位的。发送方 A 和接收方 B 分别维持一个发送窗口和一个接收窗口。发送窗口表示：在没有收到确认的情况下，可以连续把窗口内的数据全部发送出去。接收窗口表示：只允许接收落入窗口内的数据。窗口的运行    发送缓存和接收缓存发送方的应用进程把字节流写入"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092824738.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092839831.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092913134.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092926155.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092937512.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519093039090.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519093051156.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521161619337.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521161835609.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521162228671.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521162805502.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521163742499.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521164216766.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521164610953.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521164837928.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521165648599.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521165800855.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521171013649.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521171112814.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521171943148.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521172154600.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521172427993.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521173051685.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521173509815.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519091411056.png"><meta property="og:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521173617302.png"><meta property="og:updated_time" content="2021-10-12T02:34:33.977Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="计算机网络【七】"><meta name="twitter:description" content="5.6 TCP 可靠传输的实现5.6.1 以字节为单位的滑动窗口TCP 使用流水线传输和滑动窗口协议实现高效、可靠的传输。TCP 的滑动窗口是以字节为单位的。发送方 A 和接收方 B 分别维持一个发送窗口和一个接收窗口。发送窗口表示：在没有收到确认的情况下，可以连续把窗口内的数据全部发送出去。接收窗口表示：只允许接收落入窗口内的数据。窗口的运行    发送缓存和接收缓存发送方的应用进程把字节流写入"><meta name="twitter:image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092824738.png"><link rel="canonical" href="http://lyxf2000.github.io/posts/c5481d87/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>计算机网络【七】 | 乐屿心扉</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">乐屿心扉</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Keep Thinking</h1></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-playlist"><a href="/playlist/" rel="section"><i class="menu-item-icon fa fa-fw fa-music"></i><br>歌单</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://lyxf2000.github.io/posts/c5481d87/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="峻源"><meta itemprop="description" content="乐于心，乐与心，乐之屿，心扉间"><meta itemprop="image" content="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="乐屿心扉"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">计算机网络【七】</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-04-24 20:43:16" itemprop="dateCreated datePublished" datetime="2021-04-24T20:43:16+08:00">2021-04-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-10-12 10:34:33" itemprop="dateModified" datetime="2021-10-12T10:34:33+08:00">2021-10-12</time> </span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">字数统计:</span> <span class="post-count">5.8k(字)</span> </span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">阅读时长≈</span> <span class="post-count">20(分)</span></span><br><p></p></div></header><div class="post-body" itemprop="articleBody"><h3 id="5-6-TCP-可靠传输的实现"><a href="#5-6-TCP-可靠传输的实现" class="headerlink" title="5.6 TCP 可靠传输的实现"></a>5.6 TCP 可靠传输的实现</h3><h4 id="5-6-1-以字节为单位的滑动窗口"><a href="#5-6-1-以字节为单位的滑动窗口" class="headerlink" title="5.6.1   以字节为单位的滑动窗口"></a>5.6.1 以字节为单位的滑动窗口</h4><p>TCP 使用流水线传输和滑动窗口协议实现高效、可靠的传输。</p><p>TCP 的滑动窗口是以字节为单位的。</p><p><strong>发送方 A 和接收方 B 分别维持一个发送窗口和一个接收窗口。</strong></p><p>发送窗口表示：在没有收到确认的情况下，可以连续把窗口内的数据全部发送出去。</p><p>接收窗口表示：只允许接收落入窗口内的数据。</p><h5 id="窗口的运行"><a href="#窗口的运行" class="headerlink" title="窗口的运行"></a>窗口的运行</h5><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092824738.png" alt="image-20210519092824738" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092839831.png" alt="image-20210519092839831" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092913134.png" alt="image-20210519092913134" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092926155.png" alt="image-20210519092926155" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519092937512.png" alt="image-20210519092937512" style="zoom:67%"><h5 id="发送缓存和接收缓存"><a href="#发送缓存和接收缓存" class="headerlink" title="发送缓存和接收缓存"></a>发送缓存和接收缓存</h5><p>发送方的应用进程把字节流写入 TCP 的发送缓存。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519093039090.png" alt="image-20210519093039090" style="zoom:67%"><p>接收方的应用进程从 TCP 的接收缓存中读取字节流。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519093051156.png" alt="image-20210519093051156" style="zoom:67%"><p><strong>发送缓存用来暂时存放：</strong></p><ul><li><strong>发送应用程序传送给发送方 TCP 准备发送的数据；</strong></li><li><strong>TCP 已发送出但尚未收到确认的数据。</strong></li></ul><p><strong>接收缓存用来暂时存放：</strong></p><ul><li><strong>按序到达的、但尚未被接收应用程序读取的数据；</strong></li><li><strong><em>不按序到达的数据。</em></strong></li></ul><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p>第一，A 的发送窗口并不总是和 B 的接收窗口一样大（因为有一定的时间滞后）。</p><p>第二，<strong><u>TCP 标准没有规定对不按序到达的数据应如何处理。通常是先临时存放在接收窗口中，等到字节流中所缺少的字节收到后，再按序交付上层的应用进程。</u></strong></p><p>第三，TCP 要求接收方必须有累积确认的功能，这样可以减小传输开销。</p><p>接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上。<br>但请注意两点：</p><p>第一，接收方不应过分推迟发送确认，否则会导致发送方不必要的重传，这反而浪费了网络的资源。。</p><p>第二，捎带确认实际上并不经常发生，因为大多数应用程序很少同时在两个方向上发送数据。</p><h4 id="5-6-2-超时重传时间RTO-的选择"><a href="#5-6-2-超时重传时间RTO-的选择" class="headerlink" title="5.6.2   超时重传时间RTO 的选择"></a>5.6.2 超时重传时间RTO 的选择</h4><p>由于 TCP 的下层是一个互联网环境，IP 数据报所选择的路由变化很大。因而运输层的往返时间 (RTT) 的方差也很大。</p><p>如果把超时重传时间设置得太短，就会引起很多报文段的不必要的重传，使网络负荷增大。但若把超时重传时间设置得过长，则又使网络的空闲时间增大，降低了传输效率。</p><p><strong>TCP 采用了一种自适应算法，它记录一个报文段发出的时间，以及收到相应的确认的时间。这两个时间之差就是报文段的往返时间 RTT。</strong></p><p>TCP保留了RTT的一个加权平均往返时间RTTS（这又称为平滑的往返时间）。</p><p>第一次测量到 RTT 样本时，RTT<sub>S</sub> 值就取为所测量到的 RTT 样本值。以后每测量到一个新的 RTT 样本，就按下式重新计算一次 RTTS：</p><p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521161619337.png" alt="image-20210521161619337"></p><p><strong>式中，0 ≤ α ＜ 1。若 α 很接近于零，表示 RTT 值更新较慢。若选择 α接近于 1，则表示 RTT 值更新较快。</strong></p><p><strong>RFC 6298 推荐的 α 值为 1/8，即 0.125。</strong></p><p><strong>RTO (Retransmission Time-Out) 应略大于上面得出的加权平均往返时间 RTT<sub>S</sub> 。</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521161835609.png" alt="image-20210521161835609" style="zoom:67%"><p><strong>往返时间 (RTT) 的测量相当复杂</strong></p><p>TCP 报文段 1 没有收到确认。重传（即报文段 2）后，收到了确认报文段 ACK。</p><p>如何判定此确认报文段是对原来的报文段 1 的确认，还是对重传的报文段 2 的确认？</p><p><strong>Karn 算法</strong></p><ul><li><strong>在计算平均往返时间 RTT 时，只要报文段重传了，就不采用其往返时间样本。</strong>这样得出的加权平均平均往返时间 RTT<sub>S</sub> 和超时重传时间 RTO 就较准确。</li></ul><p>但是，这又引起新的问题。当报文段的时延突然增大了很多时，在原来得出的重传时间内，不会收到确认报文段。于是就重传报文段。但根据 Karn 算法，不考虑重传的报文段的往返时间样本。这样，超时重传时间就无法更新。</p><p><strong>修正的 Karn 算法</strong></p><p>报文段每重传一次，就把 RTO 增大一些：</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521162228671.png" alt="image-20210521162228671" style="zoom:67%"><h4 id="5-6-3-选择确认-SACK"><a href="#5-6-3-选择确认-SACK" class="headerlink" title="5.6.3   选择确认 SACK"></a>5.6.3 选择确认 SACK</h4><p>问题：若收到的报文段无差错，只是未按序号，中间还缺少一些序号的数据，那么能否设法只传送缺少的数据而不重传已经正确到达接收方的数据？</p><p>答案是可以的。选择确认 SACK (Selective ACK) 就是一种可行的处理方法.</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521162805502.png" alt="image-20210521162805502" style="zoom:67%"><p><strong>RFC 2018 的规定</strong></p><p>如果要使用选择确认，那么在建立 TCP 连接时，就要在 TCP 首部的选项中加上“允许 SACK”的选项，而双方必须都事先商定好。</p><p>如果使用选择确认，那么原来首部中的“确认号字段”的用法仍然不变。只是以后在 TCP 报文段的首部中都增加了 SACK 选项，以便报告收到的不连续的字节块的边界。</p><p>由于首部选项的长度最多只有 40 字节，而指明一个边界就要用掉 4 字节，因此在选项中最多只能指明 4 个字节块的边界信息。</p><h3 id="5-7-TCP-的流量控制"><a href="#5-7-TCP-的流量控制" class="headerlink" title="5.7 TCP 的流量控制"></a>5.7 TCP 的流量控制</h3><h4 id="5-7-1利用滑动窗口实现流量控制"><a href="#5-7-1利用滑动窗口实现流量控制" class="headerlink" title="5.7.1利用滑动窗口实现流量控制"></a>5.7.1利用滑动窗口实现流量控制</h4><p>一般说来，我们总是希望数据传输得更快一些。但如果发送方把数据发送得过快，接收方就可能来不及接收，这就会造成数据的丢失。</p><p><strong>流量控制 (flow control) 就是让发送方的发送速率不要太快，既要让接收方来得及接收，也不要使网络发生拥塞。利用滑动窗口机制可以很方便地在 TCP 连接上实现流量控制。</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521163742499.png" alt="image-20210521163742499" style="zoom:67%"><p><strong>可能发生死锁</strong></p><p>B 向 A 发送了零窗口的报文段后不久，B 的接收缓存又有了一些存储空间。于是 B 向 A 发送了 rwnd = 400 的报文段。</p><p>但这个报文段在传送过程中丢失了。A 一直等待收到 B 发送的非零窗口的通知，而 B 也一直等待 A 发送的数据。</p><p>如果没有其他措施，这种互相等待的死锁局面将一直延续下去。</p><p><strong>为了解决这个问题，TCP 为每一个连接设有一个持续计时器 (persistence timer)。</strong></p><p>只要 TCP 连接的一方收到对方的零窗口通知，就启动该持续计时器。</p><p><strong>若持续计时器设置的时间到期，就发送一个零窗口探测报文段（仅携带 1 字节的数据），而对方就在确认这个探测报文段时给出了现在的窗口值。</strong></p><p><strong>若窗口仍然是零，则收到这个报文段的一方就重新设置持续计时器。</strong></p><p><strong>若窗口不是零，则死锁的僵局就可以打破了。</strong></p><h4 id="5-7-2-必须考虑传输效率"><a href="#5-7-2-必须考虑传输效率" class="headerlink" title="5.7.2   必须考虑传输效率"></a>5.7.2 必须考虑传输效率</h4><p><strong>糊涂窗口综合症：每次仅发送一个字节或很少几个字节的数据时，有效数据传输效率变得很低的现象。</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521164216766.png" alt="image-20210521164216766" style="zoom:67%"><p>发送方 TCP 每次接收到一字节的数据后就发送。这样，发送一个字节需要形成 41 字节长的 IP 数据报。效率很低。</p><p>解决方法：使用 Nagle 算法。</p><p><strong>若发送应用进程把要发送的数据逐个字节地送到 TCP 的发送缓存，则发送方就<em>把第一个数据字节先发送出去<em>，把</em>后面到达的数据字节都缓存起来。</em></strong></p><blockquote><p><strong><u>第一次先发第一个一字节试探。成了再发</u></strong></p></blockquote><p><strong><em>当发送方收到对第一个数据字符的确认后，再把发送缓存中的所有数据组装成一个报文段发送出去</em>，同时继续对随后到达的数据进行缓存。</strong></p><p><strong><em>只有在收到对前一个报文段的确认后才继续发送下一个报文段。</em></strong></p><p><strong><em>当到达的数据已达到发送窗口大小的一半或已达到报文段的最大长度时，就立即发送一个报文段。</em></strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521164610953.png" alt="image-20210521164610953" style="zoom:67%"><p><strong>接收方糊涂窗口综合症</strong></p><p>当接收方的 TCP 缓冲区已满，接收方会向发送方发送窗口大小为 0 的报文。若此时接收方的应用进程以交互方式每次只读取一个字节，于是接收方又发送窗口大小为一个字节的更新报文，发送方应邀发送一个字节的数据（发送的 IP 数据报是 41 字节长），于是接收窗口又满了，如此循环往复。</p><p><strong>原因：接收方应用进程消耗数据太慢，例如：每次只读取一个字节。</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521164837928.png" alt="image-20210521164837928" style="zoom:67%"><p><strong>解决方法：让接收方等待一段时间，使得或者接收缓存已有足够空间容纳一个最长的报文段，或者等到接收缓存已有一半空闲的空间。只要出现这两种情况之一，接收方就发出确认报文，并向发送方通知当前的窗口大小。</strong></p><h3 id="5-8-TCP-的拥塞控制"><a href="#5-8-TCP-的拥塞控制" class="headerlink" title="5.8 TCP 的拥塞控制"></a>5.8 TCP 的拥塞控制</h3><h4 id="5-8-1-拥塞控制的一般原理"><a href="#5-8-1-拥塞控制的一般原理" class="headerlink" title="5.8.1   拥塞控制的一般原理"></a>5.8.1 拥塞控制的一般原理</h4><p><strong>在某段时间，若对网络中某资源的需求超过了该资源所能提供的可用部分，网络的性能就要变坏。这种现象称为拥塞 (congestion)。</strong></p><p>最坏结果：系统崩溃。</p><p>网络拥塞往往是由许多因素引起的。例如：点缓存的容量太小；链路的容量不足；处理机处理的速率太慢；拥塞本身会进一步加剧拥塞；</p><p><strong>增加资源能解决拥塞吗？</strong></p><p><strong>不能。</strong>这是因为网络拥塞是一个非常复杂的问题。简单地采用上述做法，在许多情况下，不但不能解决拥塞问题，而且还可能使网络的性能更坏。</p><p><strong>拥塞控制与流量控制的区别</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521165648599.png" alt="image-20210521165648599" style="zoom:67%"><p><strong>拥塞控制的一般原理</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521165800855.png" alt="image-20210521165800855" style="zoom:67%"><p>属于闭环控制的有以下几种措施：</p><p>(1) 监测网络系统，以便检测到拥塞在何时、何处发生。</p><p>(2) 将拥塞发生的信息传送到可采取行动的地方。</p><p>(3) 调整网络系统的运行以解决出现的问题。</p><p>主要指标有：</p><ul><li>由于缺少缓存空间而被丢弃的分组的百分数；</li><li>平均队列长度；</li><li>超时重传的分组数；</li><li>平均分组时延；</li><li>分组时延的标准差，等等。</li></ul><p>上述这些指标的上升都标志着拥塞的增长。</p><p><strong>解决拥塞的两条思路</strong></p><ul><li><p>增加网络可用资源；</p></li><li><p><strong><u>减少用户对资源的需求。</u></strong></p></li></ul><h4 id="5-8-2-TCP-的拥塞控制方法"><a href="#5-8-2-TCP-的拥塞控制方法" class="headerlink" title="5.8.2  TCP 的拥塞控制方法"></a>5.8.2 TCP 的拥塞控制方法</h4><p><strong>TCP 采用基于窗口的方法进行拥塞控制。该方法属于闭环控制方法。</strong></p><p><strong>TCP发送方维持一个拥塞窗口 cwnd (Congestion Window)</strong></p><p><strong>发送端利用拥塞窗口根据网络的拥塞情况调整发送的数据量。</strong></p><p><strong>发送窗口大小不仅取决于接收方窗口，还取决于网络的拥塞状况，所以真正的发送窗口值为：</strong></p><p><strong><u>真正的发送窗口值 = Min (接收方窗口值，拥塞窗口值)</u></strong></p><p>控制拥塞窗口的原则：只要网络没有出现拥塞，拥塞窗口就可以再增大一些，以便把更多的分组发送出去，这样就可以提高网络的利用率。但只要网络出现拥塞或有可能出现拥塞，就必须把拥塞窗口减小一些，以减少注入到网络中的分组数，以便缓解网络出现的拥塞。</p><p><strong>拥塞的判断</strong></p><ul><li><strong>重传定时器超时</strong>：网络已经发生了拥塞。</li><li><strong>收到三个重复的 ACK</strong>：预示网络可能会出现拥塞（实际可能还未发生拥塞）。</li></ul><p><strong>TCP拥塞控制算法</strong></p><p><u><strong>四种拥塞控制算法（ RFC 5681） ：</strong></u></p><ul><li><u><strong>慢开始 (slow-start)</strong></u></li><li><u><strong>拥塞避免 (congestion avoidance)</strong></u></li><li><u><strong>快重传 (fast retransmit)</strong></u></li><li><u><strong>快恢复 (fast recovery)</strong></u></li></ul><h5 id="慢开始-Slow-start"><a href="#慢开始-Slow-start" class="headerlink" title="慢开始 (Slow start)"></a>慢开始 (Slow start)</h5><p>目的：用来确定网络的负载能力或拥塞程度。</p><p>算法的思路：由小到大逐渐增大拥塞窗口数值。</p><p>两个变量：</p><ul><li><strong>拥塞窗口</strong><ul><li><strong>初始拥塞窗口值</strong>：2 种设置方法。<br>1 至 2 个最大报文段 （旧标准）<br>2 至 4 个最大报文段 （RFC 5681）</li><li><strong>窗口值逐渐增大。</strong></li></ul></li><li><strong>慢开始门限</strong>：防止拥塞窗口增长过大引起网络拥塞。</li></ul><p><strong><u>拥塞窗口 cwnd 控制方法：在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值。</u></strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521171013649.png" alt="image-20210521171013649" style="zoom:67%"> <img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521171112814.png" alt="image-20210521171112814" style="zoom:67%"><p>使用慢开始算法后，每经过一个传输轮次 (transmission round)，拥塞窗口 cwnd 就加倍。</p><p>一个传输轮次所经历的时间其实就是往返时间 RTT。</p><p><strong>“传输轮次”更加强调：把拥塞窗口 cwnd 所允许发送的报文段都连续发送出去，并收到了对已发送的最后一个字节的确认。</strong></p><p><strong>例如，拥塞窗口 cwnd = 4，这时的往返时间 RTT 就是发送方连续发送 4 个报文段，并收到这 4 个报文段的确认，总共经历的时间。</strong></p><p><strong>设置<em>慢开始门限状态变量 ssthresh</em></strong></p><p><strong>慢开始门限 ssthresh 的用法如下：</strong></p><ul><li><strong>当 cwnd &lt; ssthresh 时，使用慢开始算法。</strong></li><li><strong>当 cwnd &gt; ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。</strong></li><li><strong>当 cwnd = ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算法。</strong></li></ul><h5 id="拥塞避免算法"><a href="#拥塞避免算法" class="headerlink" title="拥塞避免算法"></a>拥塞避免算法</h5><p>思路：让拥塞窗口 cwnd 缓慢地增大，避免出现拥塞。</p><p>每经过一个传输轮次，拥塞窗口 cwnd = cwnd + 1。</p><p>使拥塞窗口 cwnd 按线性规律缓慢增长。</p><p>在拥塞避免阶段，具有 “加法增大” (Additive Increase) 的特点。</p><blockquote><p><strong><u>就是到达一定门槛了，cwnd 原来近似翻倍的指数型增长变为线性增长</u></strong></p></blockquote><p><strong>当网络出现拥塞时</strong></p><p><strong><em>无论在慢开始阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞（重传定时器超时）：</em></strong></p><ul><li><strong><em>ssthresh = max (cwnd/2，2)</em></strong></li><li><strong><em>cwnd = 1</em></strong></li><li><strong><em>执行慢开始算法</em></strong></li></ul><p>目的：迅速减少主机发送到网络中的分组数，使得发生拥塞的路由器有足够时间把队列中积压的分组处理完毕。</p><h5 id="快重传算法"><a href="#快重传算法" class="headerlink" title="快重传算法"></a>快重传算法</h5><p>发送方只要一连收到三个重复确认，就知道接收方确实没有收到报文段，因而应当立即进行重传（即“快重传”），这样就不会出现超时，发送方也不就会误认为出现了网络拥塞。</p><p>使用快重传可以使整个网络的吞吐量提高约20%。</p><p>采用快重传 FR (Fast Retransmission) 算法可以让发送方尽早知道发生了个别报文段的丢失。</p><p><strong>快重传 算法首先要求接收方不要等待自己发送数据时才进行捎带确认，而是要立即发送确认，即使收到了失序的报文段也要立即发出对已收到的报文段的重复确认。</strong></p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521171943148.png" alt="image-20210521171943148" style="zoom:67%"><h5 id="快恢复算法"><a href="#快恢复算法" class="headerlink" title="快恢复算法"></a>快恢复算法</h5><p><strong>当发送端收到连续三个重复的确认时，由于发送方现在认为网络很可能没有发生拥塞，因此现在不执行慢开始算法，而是执行快恢复算法 FR (Fast Recovery) 算法：</strong></p><ul><li><u><strong>慢开始门限 ssthresh = 当前拥塞窗口 cwnd / 2 ；</strong></u></li><li><u><strong>新拥塞窗口 cwnd = 慢开始门限 ssthresh ；</strong></u></li><li><u><strong>开始执行拥塞避免算法，使拥塞窗口缓慢地线性增大。</strong></u></li></ul><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521172154600.png" alt="image-20210521172154600" style="zoom:67%"><h5 id="TCP拥塞控制流程图"><a href="#TCP拥塞控制流程图" class="headerlink" title="TCP拥塞控制流程图"></a>TCP拥塞控制流程图</h5><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521172427993.png" alt="image-20210521172427993" style="zoom:67%"><p>发送方的发送窗口的上限值应当取为接收方窗口 rwnd 和拥塞窗口 cwnd 这两个变量中较小的一个，即应按以下公式确定：</p><p>发送窗口的上限值 = Min [rwnd, cwnd]</p><p>当 rwnd &lt; cwnd 时，是接收方的接收能力限制发送窗口的最大值。</p><p>当 cwnd &lt; rwnd 时，则是网络的拥塞限制发送窗口的最大值。</p><p>也就是说，rwnd 和 cwnd 中数值较小的一个，控制了发送方发送数据的速率。</p><h4 id="5-8-3-主动队列管理-AQM"><a href="#5-8-3-主动队列管理-AQM" class="headerlink" title="5.8.3   主动队列管理 AQM"></a>5.8.3 主动队列管理 AQM</h4><p>TCP 拥塞控制和网络层采取的策略有密切联系。若路由器对某些分组的处理时间特别长，那么这就可能使这些分组中的TCP报文段经过很长时间才能到达终点，结果引起发送方超时，对这些报文段进行重传。重传会使 TCP 连接的发送端认为在网络中发生了拥塞，但实际上网络并没有发生拥塞。<strong>对 TCP 拥塞控制影响最大的就是路由器的分组丢弃策略。</strong></p><p>路由器的队列通常都是按照<strong>“先进先出”FIFO (First In First Out)</strong> 的规则处理到来的分组。</p><p><strong>当队列已满时</strong>，以后再到达的所有分组（如果能够继续排队，这些分组都将排在队列的尾部）将都被丢弃。这就叫做<strong>尾部丢弃策略 (tail-drop policy)。</strong></p><p><strong>分组丢弃使发送方出现超时重传，使 TCP 连接进入拥塞控制的慢开始状态。</strong></p><p><strong>在这种情况下，若发生了路由器中的尾部丢弃，就可能会同时影响到很多条 TCP 连接，结果使这许多 TCP 连接在同一时间突然都进入到慢开始状态。这在 TCP 的术语中称为全局同步 (global syncronization)。</strong></p><p><strong>全局同步使得全网的通信量突然下降了很多，而在网络恢复正常后，其通信量又突然增大很多。</strong></p><p>1998 年提出了主动队列管理 AQM (Active Queue Management)。</p><p>所谓<strong>“主动”就是不要等到路由器的队列长度已经达到最大值时才不得不丢弃后面到达的分组，而是在队列长度达到某个值得警惕的数值时（即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组。</strong></p><p>AQM 可以有不同实现方法，其中曾流行多年的就是<strong>随机早期检测 RED (Random Early Detection)。</strong></p><h5 id="随机早期检测-RED-Random-Early-Detection-。"><a href="#随机早期检测-RED-Random-Early-Detection-。" class="headerlink" title="随机早期检测 RED (Random Early Detection)。"></a>随机早期检测 RED (Random Early Detection)。</h5><p>略（见PPT）</p><p>多年的实践证明，RED 的使用效果并不太理想。</p><p>2015 年公布的 RFC 7567 已经把 RFC 2309 列为“陈旧的”，并且不再推荐使用 RED。</p><p>对路由器进行主动队列管理 AQM 仍是必要的。</p><p>AQM 实际上就是对路由器中的分组排队进行智能管理，而不是简单地把队列的尾部丢弃。</p><p>现在已经有几种不同的算法来代替旧的 RED，但都还在实验阶段。</p><h3 id="5-9TCP-的运输连接管理"><a href="#5-9TCP-的运输连接管理" class="headerlink" title="5.9TCP 的运输连接管理"></a>5.9TCP 的运输连接管理</h3><p>TCP 连接的建立采用客户服务器方式。</p><p><strong>主动发起连接建立的应用进程叫做客户 (client)。</strong></p><p><strong>被动等待连接建立的应用进程叫做服务器 (server)。</strong></p><h4 id="5-9-1-TCP-的连接建立"><a href="#5-9-1-TCP-的连接建立" class="headerlink" title="5.9.1  TCP 的连接建立"></a>5.9.1 TCP 的连接建立</h4><p>TCP 建立连接的过程叫做握手。</p><p>握手需要在客户和服务器之间交换三个 TCP 报文段。称之为三报文握手。</p><p>采用三报文握手主要是为了防止已失效的连接请求报文段突然又传送到了，因而产生错误。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521173051685.png" alt="image-20210521173051685" style="zoom:67%"><p>B的 TCP 服务器进程先创建传输控制块TCB，准备接受客户进程的连接请求。</p><p>A 的 TCP 向 B 发出连接请求报文段，其首部中的同步位 SYN = 1，并选择序号 seq = x，表明传送数据时的第一个数据字节的序号是 x。</p><p>B 的 TCP 收到连接请求报文段后，如同意，则发回确认。B 在确认报文段中应使 SYN = 1，使 ACK = 1，其确认号 ack = x + 1，自己选择的序号 seq = y。</p><p>A 收到此报文段后向 B 给出确认，其 ACK = 1，确认号 ack = y + 1。A 的 TCP 通知上层应用进程，连接已经建立。</p><p>B 的 TCP 收到主机 A 的确认后，也通知其上层应用进程：TCP 连接已经建立。</p><h4 id="5-9-2-TCP-的连接释放"><a href="#5-9-2-TCP-的连接释放" class="headerlink" title="5.9.2  TCP 的连接释放"></a>5.9.2 TCP 的连接释放</h4><p>TCP 连接释放过程比较复杂。</p><p>数据传输结束后，通信的双方都可释放连接。</p><p>TCP 连接释放过程是四报文握手。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521173509815.png" alt="image-20210521173509815" style="zoom:67%"><p>数据传输结束后，通信的双方都可释放连接。现在 A 的应用进程先向其 TCP 发出连接释放报文段，并停止再发送数据，主动关闭 TCP 连接。A 把连接释放报文段首部的FIN = 1，其序号seq = u，等待 B 的确认。</p><p>B 发出确认，确认号 ack = u+1，而这个报文段自己的序号 seq = v。TCP 服务器进程通知高层应用进程。从 A 到 B 这个方向的连接就释放了，TCP 连接处于半关闭状态。B 若发送数据，A 仍要接收。</p><p>若 B 已经没有要向 A 发送的数据，其应用进程就通知 TCP 释放连接。</p><p>A 收到连接释放报文段后，必须发出确认。 在确认报文段中ACK = 1，确认号 ack = w + 1，自己的序号 seq = u + 1。</p><p>A 必须等待 2MSL 的时间:</p><ul><li>第一，为了保证 A 发送的最后一个 ACK 报文段能够到达 B。</li><li>第二，防止 “已失效的连接请求报文段”出现在本连接中。</li></ul><blockquote><p>理解</p><p>ACK：1确认号生效（所以只有带ACK的图中ack才会显示出来，可人为绑定）</p><ul><li>ack：<strong><u>是期望收到对方的下一个报文段的数据的第一个字节的序号。</u></strong></li></ul><p>seq:<strong><em>序号字段的值则指的是本报文段所发送的数据的第一个字节的序号。</em></strong></p><ul><li>无论哪种报文都会带</li></ul><p>SYN： 同步 SYN = 1 表示这是一个连接请求或连接接受报文。</p><p>FIN：FIN=1 表明此报文段的发送端的数据已发送完毕，并要求释放运输连接。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210519091411056.png" alt="image-20210519091411056" style="zoom:67%"></blockquote><p><strong>保活计时器</strong></p><p>用来防止在TCP连接出现长时期的空闲。</p><p>保活计时器 通常设置为2小时 。若服务器过了2小时还没有收到客户的信息，它就发送探测报文段。若发送了10个探测报文段（每一个相隔75秒）还没有响应，就假定客户出了故障，因而就终止该连接。</p><h4 id="5-9-3-TCP-的有限状态机"><a href="#5-9-3-TCP-的有限状态机" class="headerlink" title="5.9.3  TCP 的有限状态机"></a>5.9.3 TCP 的有限状态机</h4><p>箭头旁边的字，表明引起这种变迁的原因，或表明发生状态变迁后又出现什么动作。</p><p>图中有三种不同的箭头。</p><p>粗实线箭头表示对客户进程的正常变迁。</p><p>粗虚线箭头表示对服务器进程的正常变迁。</p><p>细线箭头表示异常变迁。</p><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/image-20210521173617302.png" alt="image-20210521173617302" style="zoom:67%"></div><div><div><div style="text-align:center;color:#555;font-size:14px">-----------------------本文结束 <i class="fa fa-heart"></i> 感谢阅读-----------------------</div></div></div><div><div id="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！恰饭^.^~</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/20190826214611.png" alt="峻源 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/20190826214431.png" alt="峻源 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>峻源</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="http://lyxf2000.github.io/posts/c5481d87/" title="计算机网络【七】">http://lyxf2000.github.io/posts/c5481d87/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/计算机网络/" rel="tag"><i class="fa fa-tag">计算机网络</i></a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/17486a18/" rel="next" title="计算机网络【六】"><i class="fa fa-chevron-left"></i> 计算机网络【六】</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/322335c4/" rel="prev" title="计算机网络【八】">计算机网络【八】 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80NjM0NC8yMjg1NQ=="></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="https://lyxf2000-1259802619.cos.ap-beijing.myqcloud.com/avatar.gif" alt="峻源"></a><p class="site-author-name" itemprop="name">峻源</p><div class="site-description motion-element" itemprop="description">乐于心，乐与心，乐之屿，心扉间</div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">124</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="mailto:1194320636@qq.com" title="QE-Mail &rarr; mailto:1194320636@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>QE-Mail</a> </span><span class="links-of-author-item"><a href="https://music.163.com/#/playlist?id=699716432" title="CloudMusic &rarr; https://music.163.com/#/playlist?id=699716432" rel="noopener" target="_blank"><i class="fa fa-fw fa-music"></i>CloudMusic</a> </span><span class="links-of-author-item"><a href="tencent://message/?uin=1194320636&Site=&menu=yes" title="QQ &rarr; tencent://message/?uin=1194320636&Site=&menu=yes" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>QQ</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://www.baidu.com/" title="https://www.baidu.com/" rel="noopener" target="_blank">百度</a></li><li class="links-of-blogroll-item"><a href="https://www.google.com/?hl=zh_CN" title="https://www.google.com/?hl=zh_CN" rel="noopener" target="_blank">谷歌</a></li><li class="links-of-blogroll-item"><a href="https://www.zhihu.com/" title="https://www.zhihu.com/" rel="noopener" target="_blank">知乎</a></li><li class="links-of-blogroll-item"><a href="https://juejin.im/" title="https://juejin.im/" rel="noopener" target="_blank">掘金</a></li><li class="links-of-blogroll-item"><a href="https://github.com/" title="https://github.com/" rel="noopener" target="_blank">github</a></li><li class="links-of-blogroll-item"><a href="https://www.luogu.org/" title="https://www.luogu.org/" rel="noopener" target="_blank">洛谷</a></li></ul></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-TCP-可靠传输的实现"><span class="nav-number">1.</span> <span class="nav-text">5.6 TCP 可靠传输的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-1-以字节为单位的滑动窗口"><span class="nav-number">1.1.</span> <span class="nav-text">5.6.1 以字节为单位的滑动窗口</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#窗口的运行"><span class="nav-number">1.1.1.</span> <span class="nav-text">窗口的运行</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#发送缓存和接收缓存"><span class="nav-number">1.1.2.</span> <span class="nav-text">发送缓存和接收缓存</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#注意"><span class="nav-number">1.1.3.</span> <span class="nav-text">注意</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-2-超时重传时间RTO-的选择"><span class="nav-number">1.2.</span> <span class="nav-text">5.6.2 超时重传时间RTO 的选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-3-选择确认-SACK"><span class="nav-number">1.3.</span> <span class="nav-text">5.6.3 选择确认 SACK</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-7-TCP-的流量控制"><span class="nav-number">2.</span> <span class="nav-text">5.7 TCP 的流量控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-7-1利用滑动窗口实现流量控制"><span class="nav-number">2.1.</span> <span class="nav-text">5.7.1利用滑动窗口实现流量控制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-7-2-必须考虑传输效率"><span class="nav-number">2.2.</span> <span class="nav-text">5.7.2 必须考虑传输效率</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-TCP-的拥塞控制"><span class="nav-number">3.</span> <span class="nav-text">5.8 TCP 的拥塞控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-8-1-拥塞控制的一般原理"><span class="nav-number">3.1.</span> <span class="nav-text">5.8.1 拥塞控制的一般原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-8-2-TCP-的拥塞控制方法"><span class="nav-number">3.2.</span> <span class="nav-text">5.8.2 TCP 的拥塞控制方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#慢开始-Slow-start"><span class="nav-number">3.2.1.</span> <span class="nav-text">慢开始 (Slow start)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#拥塞避免算法"><span class="nav-number">3.2.2.</span> <span class="nav-text">拥塞避免算法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#快重传算法"><span class="nav-number">3.2.3.</span> <span class="nav-text">快重传算法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#快恢复算法"><span class="nav-number">3.2.4.</span> <span class="nav-text">快恢复算法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TCP拥塞控制流程图"><span class="nav-number">3.2.5.</span> <span class="nav-text">TCP拥塞控制流程图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-8-3-主动队列管理-AQM"><span class="nav-number">3.3.</span> <span class="nav-text">5.8.3 主动队列管理 AQM</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#随机早期检测-RED-Random-Early-Detection-。"><span class="nav-number">3.3.1.</span> <span class="nav-text">随机早期检测 RED (Random Early Detection)。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-9TCP-的运输连接管理"><span class="nav-number">4.</span> <span class="nav-text">5.9TCP 的运输连接管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-9-1-TCP-的连接建立"><span class="nav-number">4.1.</span> <span class="nav-text">5.9.1 TCP 的连接建立</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-9-2-TCP-的连接释放"><span class="nav-number">4.2.</span> <span class="nav-text">5.9.2 TCP 的连接释放</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-9-3-TCP-的有限状态机"><span class="nav-number">4.3.</span> <span class="nav-text">5.9.3 TCP 的有限状态机</span></a></li></ol></li></ol></div></div></div><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love" id="heart"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">峻源</span></div><span>本站已运行<span id="showDays"></span></span><script>var seconds=1e3,minutes=60*seconds,hours=60*minutes,days=24*hours,years=365*days,birthDay=Date.UTC(2019,8,1,14,0,0);setInterval(function(){var e=new Date,s=e.getFullYear(),t=e.getMonth()+1,a=e.getDate(),o=e.getHours(),r=e.getMinutes(),n=e.getSeconds(),h=Date.UTC(s,t,a,o,r,n),u=h-birthDay,d=Math.floor(u/years),y=Math.floor(u/days-365*d),i=Math.floor((u-(365*d+y)*days)/hours),l=Math.floor((u-(365*d+y)*days-i*hours)/minutes),M=Math.floor((u-(365*d+y)*days-i*hours-l*minutes)/seconds);document.getElementById("showDays").innerHTML=""+d+"年"+y+"天"+i+"小时"+l+"分钟"+M+"秒"},1e3)</script><div><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">访问人数：<span id="busuanzi_value_site_uv"></span> </span>&nbsp;|&nbsp; <i class="fa fa-eye"></i> <span id="busuanzi_container_site_pv">总访问量：<span id="busuanzi_value_site_pv"></span> </span>&nbsp;|&nbsp; <i class="fa fa-pencil"></i> <span class="post-count">博客全站共 464.2k 字</span></div></div></footer></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=3.4.1"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script><script src="/js/utils.js?v=7.2.0"></script><script src="/js/motion.js?v=7.2.0"></script><script src="/js/affix.js?v=7.2.0"></script><script src="/js/schemes/pisces.js?v=7.2.0"></script><script src="/js/scrollspy.js?v=7.2.0"></script><script src="/js/post-details.js?v=7.2.0"></script><script src="/js/next-boot.js?v=7.2.0"></script><script>window.livereOptions={refer:"posts/c5481d87/"},function(e,t){var n,r=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&(n=e.createElement(t),n.src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,r.parentNode.insertBefore(n,r))}(document,"script")</script><script>function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var e=$("#local-search-input");e.attr("autocapitalize","none"),e.attr("autocorrect","off"),e.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(e){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(e,t,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:e,dataType:isXml?"xml":"json",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():e,r=document.getElementById(t),s=document.getElementById(o),a=function(){var e=r.value.trim().toLowerCase(),t=e.split(/[\s\-]+/);t.length>1&&t.push(e);var o=[];if(e.length>0&&n.forEach(function(n){function r(t,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===e&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(e,t){var o="",n=t.start;return t.hits.forEach(function(t){o+=e.substring(n,t.position);var r=t.position+t.length;o+='<b class="search-keyword">'+e.substring(t.position,r)+"</b>",n=r}),o+=e.substring(n,t.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url).replace(/\/{2,}/g,"/"),d=[],g=[];if(""!=l&&(t.forEach(function(e){function t(e,t,o){var n=e.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(t=t.toLowerCase(),e=e.toLowerCase());(s=t.indexOf(e,r))>-1;)a.push({position:s,word:e}),r=s+n;return a}d=d.concat(t(e,h,!1)),g=g.concat(t(e,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(e){b+="<a href='"+f+'\'><p class="search-result">'+s(p,e)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===t.length&&""===t[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>';else{o.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id});var a='<ul class="search-result-list">';o.forEach(function(e){a+=e.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(e){e.stopPropagation()}),$(document).on("keyup",function(e){var t=27===e.which&&$(".search-popup").is(":visible");t&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><link rel="stylesheet" href="/dist/APlayer.min.css"><div id="aplayer"></div><script type="text/javascript" src="/dist/APlayer.min.js"></script><script type="text/javascript" src="/dist/music.js"></script><script type="text/javascript" src="/js/firework.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":220,"height":400},"mobile":{"show":false},"react":{"opacity":0.9},"log":false});</script></body></html><!-- rebuild by neat -->